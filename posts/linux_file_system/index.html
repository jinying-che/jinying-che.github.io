<!doctype html><html lang=en><head><title>Linux File System ::</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="File System Overview"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://jinying-che.github.io/posts/linux_file_system/><link rel=stylesheet href=https://jinying-che.github.io/styles.css><link rel="shortcut icon" href=https://jinying-che.github.io/img/theme-colors/green.png><link rel=apple-touch-icon href=https://jinying-che.github.io/img/theme-colors/green.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Linux File System"><meta property="og:description" content="File System Overview"><meta property="og:url" content="https://jinying-che.github.io/posts/linux_file_system/"><meta property="og:site_name" content><meta property="og:image" content="https://jinying-che.github.io/img/favicon/green.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2023-09-30 15:25:41 +0800 +0800"></head><body class=green><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>jinying-che:~#</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/posts>Home</a></li><li><a href=/tags>Tags</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/posts>Home</a></li><li><a href=/tags>Tags</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://jinying-che.github.io/posts/linux_file_system/>Linux File System</a></h1><div class=post-meta><time class=post-date>2023-09-30 ::</time></div><span class=post-tags>#<a href=https://jinying-che.github.io/tags/linux/>linux</a>&nbsp;</span><div class=post-content><div><h2 id=architecture>Architecture<a href=#architecture class=hanchor arialabel=Anchor>&#8983;</a></h2><p><img src=/images/linux_file_system.svg alt="file system"></p><h2 id=vfs>VFS<a href=#vfs class=hanchor arialabel=Anchor>&#8983;</a></h2><p>The Virtual File System (also known as the Virtual Filesystem Switch) is the software layer in the kernel that provides the filesystem interface to userspace programs via system call. It also provides an abstraction within the kernel which allows different filesystem implementations to coexist.</p><p>A VFS specifies an interface (or a &ldquo;contract&rdquo;) between the kernel and a concrete file system. Therefore, it is easy to add support for new file system types to the kernel simply by fulfilling the contract.</p><h4 id=superblock>Superblock<a href=#superblock class=hanchor arialabel=Anchor>&#8983;</a></h4><p>The superblock records various information about the enclosing filesystem, such as block counts, inode counts, supported features, maintenance information, and more.</p><p>Show the super block info in Linux:</p><blockquote><p>all examples in this post are from my vps (OS: Ubuntu 22.04.2 LTS)</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ df -h
</span></span><span style=display:flex><span>Filesystem      Size  Used Avail Use% Mounted on
</span></span><span style=display:flex><span>tmpfs            96M  1.3M   95M   2% /run
</span></span><span style=display:flex><span>/dev/vda1        24G   12G   11G  52% /
</span></span><span style=display:flex><span>tmpfs           479M     <span style=color:#ae81ff>0</span>  479M   0% /dev/shm
</span></span><span style=display:flex><span>tmpfs           5.0M     <span style=color:#ae81ff>0</span>  5.0M   0% /run/lock
</span></span><span style=display:flex><span>tmpfs            96M  4.0K   96M   1% /run/user/0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ dumpe2fs /dev/vda1
</span></span><span style=display:flex><span>dumpe2fs 1.46.5 <span style=color:#f92672>(</span>30-Dec-2021<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Filesystem volume name:   &lt;none&gt;
</span></span><span style=display:flex><span>Last mounted on:          /
</span></span><span style=display:flex><span>Filesystem UUID:          cc673143-6902-4174-990e-8cba0304cb7a
</span></span><span style=display:flex><span>Filesystem magic number:  0xEF53
</span></span><span style=display:flex><span>Filesystem revision <span style=color:#75715e>#:    1 (dynamic)</span>
</span></span><span style=display:flex><span>Filesystem features:      has_journal ext_attr resize_inode dir_index filetype needs_recovery extent 64bit flex_bg sparse_super large_file huge_file dir_nlink extra_isize metadata_csum
</span></span><span style=display:flex><span>Filesystem flags:         signed_directory_hash
</span></span><span style=display:flex><span>Default mount options:    user_xattr acl discard
</span></span><span style=display:flex><span>Filesystem state:         clean
</span></span><span style=display:flex><span>Errors behavior:          Continue
</span></span><span style=display:flex><span>Filesystem OS type:       Linux
</span></span><span style=display:flex><span>Inode count:              <span style=color:#ae81ff>6537600</span>
</span></span><span style=display:flex><span>Block count:              <span style=color:#ae81ff>6553339</span>
</span></span><span style=display:flex><span>Reserved block count:     <span style=color:#ae81ff>327666</span>
</span></span><span style=display:flex><span>Free blocks:              <span style=color:#ae81ff>3333553</span>
</span></span><span style=display:flex><span>Free inodes:              <span style=color:#ae81ff>6325191</span>
</span></span><span style=display:flex><span>First block:              <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Block size:               <span style=color:#ae81ff>4096</span>
</span></span><span style=display:flex><span>Fragment size:            <span style=color:#ae81ff>4096</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p><code>Source Code</code>: <a href=https://github.com/torvalds/linux/blob/b9ddbb0cde2adcedda26045cc58f31316a492215/include/linux/fs.h#L1188>super_block c source code</a></p><h4 id=directory-entry-dentry>Directory Entry (Dentry)<a href=#directory-entry-dentry class=hanchor arialabel=Anchor>&#8983;</a></h4><ol><li>Dentry is used by VFS to represent information about the <strong>directories and files</strong> inside the <strong>memory</strong></li><li>Dentries live in RAM and are never saved to disc: they exist only for performance. (RAM cannot save all dentries -> LFU cache)</li><li>An individual dentry usually has a pointer to an inode</li><li>It&rsquo;s a fast look-up mechanism to translate a pathname (filename) into a specific <strong>dentry</strong> then <strong>inode</strong></li></ol><p><code>Source Code</code>: <a href=https://github.com/torvalds/linux/blob/b9ddbb0cde2adcedda26045cc58f31316a492215/include/linux/dcache.h#L82>dentry c source code</a></p><h4 id=index-node>Index Node<a href=#index-node class=hanchor arialabel=Anchor>&#8983;</a></h4><ol><li>Index node(Inode) is a data structure that stores ownership, permissions, file size, and other metadata-related terms.</li><li>They live either on the disc (for block device filesystems) or in the memory (for pseudo filesystems). Inodes that live on the disc are copied into the memory when required and changes to the inode are written back to disc.</li><li>Every file and directory on Linux is represented by a unique inode number used by the system to identify it on the file system.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># ls</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   -i, --inode</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#     print the index number of each file</span>
</span></span><span style=display:flex><span>$ ls -i workspace/main.go
</span></span><span style=display:flex><span><span style=color:#ae81ff>1067025</span> workspace/main.go
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ ls -i workspace
</span></span><span style=display:flex><span><span style=color:#ae81ff>1067025</span> main.go
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># stat - display file or file system status</span>
</span></span><span style=display:flex><span>$ stat workspace/main.go
</span></span><span style=display:flex><span>  File: workspace/main.go
</span></span><span style=display:flex><span>  Size: <span style=color:#ae81ff>72</span>              Blocks: <span style=color:#ae81ff>8</span>          IO Block: <span style=color:#ae81ff>4096</span>   regular file
</span></span><span style=display:flex><span>Device: fc01h/64513d    Inode: <span style=color:#ae81ff>1067025</span>     Links: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Access: <span style=color:#f92672>(</span>0644/-rw-r--r--<span style=color:#f92672>)</span>  Uid: <span style=color:#f92672>(</span>    0/    root<span style=color:#f92672>)</span>   Gid: <span style=color:#f92672>(</span>    0/    root<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Access: 2023-10-09 22:12:30.884848072 +0800
</span></span><span style=display:flex><span>Modify: 2023-06-11 22:44:14.194331022 +0800
</span></span><span style=display:flex><span>Change: 2023-06-11 22:44:14.194331022 +0800
</span></span><span style=display:flex><span> Birth: 2023-06-11 22:44:14.194331022 +0800
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ stat workspace
</span></span><span style=display:flex><span>  File: workspace
</span></span><span style=display:flex><span>  Size: <span style=color:#ae81ff>4096</span>            Blocks: <span style=color:#ae81ff>8</span>          IO Block: <span style=color:#ae81ff>4096</span>   directory
</span></span><span style=display:flex><span>Device: fc01h/64513d    Inode: <span style=color:#ae81ff>1066674</span>     Links: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>Access: <span style=color:#f92672>(</span>0755/drwxr-xr-x<span style=color:#f92672>)</span>  Uid: <span style=color:#f92672>(</span>    0/    root<span style=color:#f92672>)</span>   Gid: <span style=color:#f92672>(</span>    0/    root<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Access: 2023-10-09 22:12:33.196939026 +0800
</span></span><span style=display:flex><span>Modify: 2023-10-09 22:12:32.612916118 +0800
</span></span><span style=display:flex><span>Change: 2023-10-09 22:12:32.612916118 +0800
</span></span><span style=display:flex><span> Birth: 2023-06-11 22:43:01.453639583 +0800
</span></span></code></pre></div><p><code>Source Code</code>: <a href=https://github.com/torvalds/linux/blob/94f6f0550c625fab1f373bb86a6669b45e9748b3/include/linux/fs.h#L639>inode c source code</a></p><h4 id=file>File<a href=#file class=hanchor arialabel=Anchor>&#8983;</a></h4><ol><li>The file object is the in-memory representation of an open file.</li><li>The file object is initialized with a pointer to the dentry and a set of file operation member functions which are taken from the inode data.</li><li>The file structure is placed into the file descriptor table for the process.</li><li>Reading, writing and closing files are done by using the userspace <strong>file descriptor</strong> to grab the appropriate file structure.</li></ol><p><code>Source Code</code>: <a href=https://github.com/torvalds/linux/blob/b9ddbb0cde2adcedda26045cc58f31316a492215/include/linux/fs.h#L992>file c source code</a></p><h2 id=what-happens-when-reading-a-file-in-linux>What happens when reading a file in Linux?<a href=#what-happens-when-reading-a-file-in-linux class=hanchor arialabel=Anchor>&#8983;</a></h2><p>TBD Diagram to elaborate on the concepts above</p><h2 id=block-layer>Block Layer<a href=#block-layer class=hanchor arialabel=Anchor>&#8983;</a></h2><p>TBD</p><h2 id=troubleshooting>Troubleshooting<a href=#troubleshooting class=hanchor arialabel=Anchor>&#8983;</a></h2><ol><li><p>df & du</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># df displays the amount of disk space available on the file system containing each file name argument</span>
</span></span><span style=display:flex><span>$ df -h
</span></span><span style=display:flex><span>Filesystem      Size  Used Avail Use% Mounted on
</span></span><span style=display:flex><span>tmpfs            96M  1.3M   95M   2% /run
</span></span><span style=display:flex><span>/dev/vda1        24G   12G   11G  52% /
</span></span><span style=display:flex><span>tmpfs           479M     <span style=color:#ae81ff>0</span>  479M   0% /dev/shm
</span></span><span style=display:flex><span>tmpfs           5.0M     <span style=color:#ae81ff>0</span>  5.0M   0% /run/lock
</span></span><span style=display:flex><span>tmpfs            96M  4.0K   96M   1% /run/user/0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># du Summarize disk usage of the set of FILEs, recursively for directories.</span>
</span></span><span style=display:flex><span>/usr &gt; du -h --max-depth<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#75715e># display the usage of first depth in a human readable format </span>
</span></span><span style=display:flex><span>4.0K    ./lib32
</span></span><span style=display:flex><span>32M     ./sbin
</span></span><span style=display:flex><span>465M    ./src
</span></span><span style=display:flex><span>4.0K    ./lib64
</span></span><span style=display:flex><span>439M    ./share
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># display the usage of this depth and sort the output in a human readable format</span>
</span></span><span style=display:flex><span>$ du -hs * | sort -rh | head -10 
</span></span><span style=display:flex><span>5.0G    usr
</span></span><span style=display:flex><span>3.9G    var
</span></span><span style=display:flex><span>2.4G    swapfile
</span></span><span style=display:flex><span>1.1G    snap
</span></span><span style=display:flex><span>...
</span></span></code></pre></div></li><li><p>iostat (device level)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># Display a continuous device report of extended statistics at two second intervals.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># take note of the following statistics: </span>
</span></span><span style=display:flex><span><span style=color:#75715e># - %util: percentage of elapsed time during which I/O requests were issued to the device </span>
</span></span><span style=display:flex><span><span style=color:#75715e># - r/s, w/s: read/write requests per second for the device</span>
</span></span><span style=display:flex><span><span style=color:#75715e># - rKB/s, rWB/s: the number of sectors (kilobytes, megabytes) read/write for the device per second</span>
</span></span><span style=display:flex><span><span style=color:#75715e># - r_await, w_await: the average time (in milliseconds) for read/write requests issued to the device to be served. This includes the time spent by the requests in queue and the time spent servicing them.</span>
</span></span><span style=display:flex><span>$ iostat -x -d <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>Device            r/s     rkB/s   rrqm/s  %rrqm r_await rareq-sz     w/s     wkB/s   wrqm/s  %wrqm w_await wareq-sz     d/s     dkB/s   drqm/s  %drqm d_await dareq-sz     f/s f_await  aqu-sz  %util
</span></span><span style=display:flex><span>loop0            0.00      0.02     0.00   0.00    0.29    47.11    0.00      0.00     0.00   0.00    0.00     0.00    0.00      0.00     0.00   0.00    0.00     0.00    0.00    0.00    0.00   0.00
</span></span><span style=display:flex><span>loop1            0.00      0.00     0.00   0.00    0.14    34.80    0.00      0.00     0.00   0.00    0.00     0.00    0.00      0.00     0.00   0.00    0.00     0.00    0.00    0.00    0.00   0.00
</span></span><span style=display:flex><span>sr0              0.00      0.00     0.00   0.00    0.00     0.12    0.00      0.00     0.00   0.00    0.00     0.00    0.00      0.00     0.00   0.00    0.00     0.00    0.00    0.00    0.00   0.00
</span></span><span style=display:flex><span>vda              0.24      6.06     0.09  28.32    0.37    25.79    2.18     15.93     0.48  17.94    0.38     7.32    0.01      8.63     0.00   0.00    2.14  1258.27    0.20    0.14    0.00   0.10
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Device            r/s     rkB/s   rrqm/s  %rrqm r_await rareq-sz     w/s     wkB/s   wrqm/s  %wrqm w_await wareq-sz     d/s     dkB/s   drqm/s  %drqm d_await dareq-sz     f/s f_await  aqu-sz  %util
</span></span><span style=display:flex><span>loop0            0.00      0.00     0.00   0.00    0.00     0.00    0.00      0.00     0.00   0.00    0.00     0.00    0.00      0.00     0.00   0.00    0.00     0.00    0.00    0.00    0.00   0.00
</span></span><span style=display:flex><span>loop1            0.00      0.00     0.00   0.00    0.00     0.00    0.00      0.00     0.00   0.00    0.00     0.00    0.00      0.00     0.00   0.00    0.00     0.00    0.00    0.00    0.00   0.00
</span></span><span style=display:flex><span>sr0              0.00      0.00     0.00   0.00    0.00     0.00    0.00      0.00     0.00   0.00    0.00     0.00    0.00      0.00     0.00   0.00    0.00     0.00    0.00    0.00    0.00   0.00
</span></span><span style=display:flex><span>vda              0.00      0.00     0.00   0.00    0.00     0.00    1.00     30.00     6.50  86.67    0.50    30.00    0.50      2.00     0.00   0.00    2.00     4.00    1.00    0.00    0.00   0.20
</span></span></code></pre></div></li><li><p>pidstat (process level)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># pidstat - Report statistics for Linux tasks.</span>
</span></span><span style=display:flex><span>$ pidstat -d <span style=color:#ae81ff>1</span> <span style=color:#75715e># report I/O statistics per second </span>
</span></span><span style=display:flex><span>11:11:01 PM     <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>387</span>      0.00     16.00      0.00       <span style=color:#ae81ff>0</span>  systemd-journal
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>11:11:01 PM   UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command
</span></span><span style=display:flex><span>11:11:02 PM     <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>387</span>      0.00     36.00      0.00       <span style=color:#ae81ff>0</span>  systemd-journal
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>11:11:02 PM   UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command
</span></span><span style=display:flex><span>11:11:03 PM     <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>387</span>      0.00     32.00      0.00       <span style=color:#ae81ff>0</span>  systemd-journal
</span></span><span style=display:flex><span>11:11:03 PM     <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>825</span>      0.00      4.00      0.00       <span style=color:#ae81ff>0</span>  sshd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ pidstat -d -p <span style=color:#ae81ff>387</span> <span style=color:#ae81ff>1</span> <span style=color:#75715e># report I/O statistics for process 387 per second </span>
</span></span><span style=display:flex><span>11:11:24 PM   UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command
</span></span><span style=display:flex><span>11:11:25 PM     <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>387</span>      0.00     16.00      0.00       <span style=color:#ae81ff>0</span>  systemd-journal
</span></span><span style=display:flex><span>11:11:26 PM     <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>387</span>      0.00      0.00      0.00       <span style=color:#ae81ff>0</span>  systemd-journal
</span></span><span style=display:flex><span>11:11:27 PM     <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>387</span>      0.00     32.00      0.00       <span style=color:#ae81ff>0</span>  systemd-journal
</span></span><span style=display:flex><span>11:11:28 PM     <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>387</span>      0.00      0.00      0.00       <span style=color:#ae81ff>0</span>  systemd-journal
</span></span></code></pre></div></li><li><p>iotop</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># iotop - simple top-like I/O monitor</span>
</span></span><span style=display:flex><span><span style=color:#75715e># NOTE: not handy as kernal config may need to update (at least the CONFIG_TASK_DELAY_ACCT, CONFIG_TASK_IO_ACCOUNTING, CON-FIG_TASKSTATS and CONFIG_VM_EVENT_COUNTERS options need to be enabled in your Linux kernel build configuration.)</span>
</span></span><span style=display:flex><span>$ iotop
</span></span><span style=display:flex><span>Total DISK READ :       0.00 B/s | Total DISK WRITE :       7.85 K/s 
</span></span><span style=display:flex><span>Actual DISK READ:       0.00 B/s | Actual DISK WRITE:       0.00 B/s 
</span></span><span style=display:flex><span>  TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO&gt;    COMMAND 
</span></span><span style=display:flex><span><span style=color:#ae81ff>15055</span> be/3 root        0.00 B/s    7.85 K/s  0.00 %  0.00 % systemd-journald 
</span></span></code></pre></div></li><li><p>strace</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># strace - trace system calls and signals</span>
</span></span><span style=display:flex><span><span style=color:#75715e># process 654373 is a prometheus node exporter, through the strace (system calls), it&#39;s able to roughly understand how does node exporter work </span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ strace -p <span style=color:#ae81ff>654373</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>newfstatat<span style=color:#f92672>(</span>AT_FDCWD, <span style=color:#e6db74>&#34;/proc&#34;</span>, <span style=color:#f92672>{</span>st_mode<span style=color:#f92672>=</span>S_IFDIR|0555, st_size<span style=color:#f92672>=</span>0, ...<span style=color:#f92672>}</span>, 0<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>statfs<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/proc&#34;</span>, <span style=color:#f92672>{</span>f_type<span style=color:#f92672>=</span>PROC_SUPER_MAGIC, f_bsize<span style=color:#f92672>=</span>4096, f_blocks<span style=color:#f92672>=</span>0, f_bfree<span style=color:#f92672>=</span>0, f_bavail<span style=color:#f92672>=</span>0, f_files<span style=color:#f92672>=</span>0, f_ffree<span style=color:#f92672>=</span>0, f_fsid<span style=color:#f92672>={</span>val<span style=color:#f92672>=[</span>0, 0<span style=color:#f92672>]}</span>, f_namelen<span style=color:#f92672>=</span>255, f_frsize<span style=color:#f92672>=</span>4096, f_flags<span style=color:#f92672>=</span>ST_VALID|ST_NOSUID|ST_NODEV|ST_NOEXEC|ST_RELATIME<span style=color:#f92672>})</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>newfstatat<span style=color:#f92672>(</span>AT_FDCWD, <span style=color:#e6db74>&#34;/proc/655152&#34;</span>, <span style=color:#f92672>{</span>st_mode<span style=color:#f92672>=</span>S_IFDIR|0555, st_size<span style=color:#f92672>=</span>0, ...<span style=color:#f92672>}</span>, 0<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>openat<span style=color:#f92672>(</span>AT_FDCWD, <span style=color:#e6db74>&#34;/proc/655152/stat&#34;</span>, O_RDONLY|O_CLOEXEC<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span>fcntl<span style=color:#f92672>(</span>8, F_GETFL<span style=color:#f92672>)</span>                       <span style=color:#f92672>=</span> 0x8000 <span style=color:#f92672>(</span>flags O_RDONLY|O_LARGEFILE<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>fcntl<span style=color:#f92672>(</span>8, F_SETFL, O_RDONLY|O_NONBLOCK|O_LARGEFILE<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>epoll_ctl<span style=color:#f92672>(</span>4, EPOLL_CTL_ADD, 8, <span style=color:#f92672>{</span>events<span style=color:#f92672>=</span>EPOLLIN|EPOLLOUT|EPOLLRDHUP|EPOLLET, data<span style=color:#f92672>={</span>u32<span style=color:#f92672>=</span>1268860600, u64<span style=color:#f92672>=</span>139673605326520<span style=color:#f92672>}})</span> <span style=color:#f92672>=</span> -1 EPERM <span style=color:#f92672>(</span>Operation not permitted<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>fcntl<span style=color:#f92672>(</span>8, F_GETFL<span style=color:#f92672>)</span>                       <span style=color:#f92672>=</span> 0x8800 <span style=color:#f92672>(</span>flags O_RDONLY|O_NONBLOCK|O_LARGEFILE<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>fcntl<span style=color:#f92672>(</span>8, F_SETFL, O_RDONLY|O_LARGEFILE<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>read<span style=color:#f92672>(</span>8, <span style=color:#e6db74>&#34;655152 (node_exporter) R 655107 &#34;</span>..., 512<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>308</span>
</span></span><span style=display:flex><span>read<span style=color:#f92672>(</span>8, <span style=color:#e6db74>&#34;&#34;</span>, 204<span style=color:#f92672>)</span>                        <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>close<span style=color:#f92672>(</span>8<span style=color:#f92672>)</span>                                <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>openat<span style=color:#f92672>(</span>AT_FDCWD, <span style=color:#e6db74>&#34;/proc/stat&#34;</span>, O_RDONLY|O_CLOEXEC<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span>fcntl<span style=color:#f92672>(</span>8, F_GETFL<span style=color:#f92672>)</span>                       <span style=color:#f92672>=</span> 0x8000 <span style=color:#f92672>(</span>flags O_RDONLY|O_LARGEFILE<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>fcntl<span style=color:#f92672>(</span>8, F_SETFL, O_RDONLY|O_NONBLOCK|O_LARGEFILE<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>epoll_ctl<span style=color:#f92672>(</span>4, EPOLL_CTL_ADD, 8, <span style=color:#f92672>{</span>events<span style=color:#f92672>=</span>EPOLLIN|EPOLLOUT|EPOLLRDHUP|EPOLLET, data<span style=color:#f92672>={</span>u32<span style=color:#f92672>=</span>1268860600, u64<span style=color:#f92672>=</span>139673605326520<span style=color:#f92672>}})</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>read<span style=color:#f92672>(</span>8, <span style=color:#e6db74>&#34;cpu  773459 68488 441098 3776333&#34;</span>..., 512<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>512</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div></li><li><p>lsof</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># lsof - lists on its standard output file information about files opened by processes</span>
</span></span><span style=display:flex><span><span style=color:#75715e># An open file may be a regular file, a directory, a block special file, a character special file, an executing text reference, a library, a stream or a network file (Internet socket, NFS file or UNIX domain socket.)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># man lsof for more details </span>
</span></span><span style=display:flex><span>$ lsof -p <span style=color:#ae81ff>654373</span> <span style=color:#75715e># list all files opened by node exporter</span>
</span></span><span style=display:flex><span>COMMAND      PID USER   FD      TYPE   DEVICE SIZE/OFF     NODE NAME
</span></span><span style=display:flex><span>node_expo <span style=color:#ae81ff>655152</span> root  cwd       DIR    252,1     <span style=color:#ae81ff>4096</span>  <span style=color:#ae81ff>1046028</span> /root/workspace/node_exporter-1.6.1.linux-amd64
</span></span><span style=display:flex><span>node_expo <span style=color:#ae81ff>655152</span> root  rtd       DIR    252,1     <span style=color:#ae81ff>4096</span>        <span style=color:#ae81ff>2</span> /
</span></span><span style=display:flex><span>node_expo <span style=color:#ae81ff>655152</span> root  txt       REG    252,1 <span style=color:#ae81ff>20025119</span>  <span style=color:#ae81ff>1046289</span> /root/workspace/node_exporter-1.6.1.linux-amd64/node_exporter
</span></span><span style=display:flex><span>node_expo <span style=color:#ae81ff>655152</span> root    0u      CHR    136,5      0t0        <span style=color:#ae81ff>8</span> /dev/pts/5
</span></span><span style=display:flex><span>node_expo <span style=color:#ae81ff>655152</span> root    1u      CHR    136,5      0t0        <span style=color:#ae81ff>8</span> /dev/pts/5
</span></span><span style=display:flex><span>node_expo <span style=color:#ae81ff>655152</span> root    2u      CHR    136,5      0t0        <span style=color:#ae81ff>8</span> /dev/pts/5
</span></span><span style=display:flex><span>node_expo <span style=color:#ae81ff>655152</span> root    3u     IPv6 <span style=color:#ae81ff>10182875</span>      0t0      TCP *:9100 <span style=color:#f92672>(</span>LISTEN<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>node_expo <span style=color:#ae81ff>655152</span> root    4u  a_inode     0,14        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>12477</span> <span style=color:#f92672>[</span>eventpoll<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>node_expo <span style=color:#ae81ff>655152</span> root    5r     FIFO     0,13      0t0 <span style=color:#ae81ff>10182871</span> pipe
</span></span><span style=display:flex><span>node_expo <span style=color:#ae81ff>655152</span> root    6w     FIFO     0,13      0t0 <span style=color:#ae81ff>10182871</span> pipe
</span></span></code></pre></div></li></ol><h2 id=linux-storage-stack>Linux Storage Stack<a href=#linux-storage-stack class=hanchor arialabel=Anchor>&#8983;</a></h2><p><img src=/images/Linux-storage-stack-diagram_v6.2/linux_storage_stack.svg alt="linux storage stack">
<a href=https://www.thomas-krenn.com/en/wiki/Linux_Storage_Stack_Diagram>https://www.thomas-krenn.com/en/wiki/Linux_Storage_Stack_Diagram</a></p><h2 id=reference>Reference<a href=#reference class=hanchor arialabel=Anchor>&#8983;</a></h2><ul><li><a href=https://developer.ibm.com/tutorials/l-linux-filesystem/>https://developer.ibm.com/tutorials/l-linux-filesystem/</a></li><li><a href="https://www.kernel.org/doc/html/latest/filesystems/ext4/globals.html?highlight=file+system+super+block">super block &ndash; kernel doc</a></li><li><a href="https://www.kernel.org/doc/html/latest/filesystems/vfs.html?highlight=inode">vfs overview &ndash; kernel doc</a></li><li><a href="https://itslinuxfoss.com/what-is-superblock-inode-dentry-and-file/#:~:text=The%20superblock%20is%20the%20data,of%20bytes%20in%20different%20forms.">What is a Superblock, Dentry, Inode and a File?</a></li></ul></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button next"><a href=https://jinying-che.github.io/posts/linux_memory/><span class=button__text>Linux Memory</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2023 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>