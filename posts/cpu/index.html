<!doctype html><html lang=en><head><title>CPU ::</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Linux CPU Overview"><meta name=keywords content="computer,ai,network"><meta name=robots content="noodp"><link rel=canonical href=https://chejinying.com/tech/posts/cpu/><link rel=stylesheet href=https://chejinying.com/tech/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://chejinying.com/tech/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://chejinying.com/tech/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://chejinying.com/tech/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://chejinying.com/tech/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://chejinying.com/tech/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://chejinying.com/tech/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css><link rel=stylesheet href=https://chejinying.com/tech/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css><link rel=stylesheet href=https://chejinying.com/tech/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://chejinying.com/tech/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css><link rel=stylesheet href=https://chejinying.com/tech/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css><link rel=stylesheet href=https://chejinying.com/tech/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link rel=stylesheet href=https://chejinying.com/tech/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel=stylesheet href=https://chejinying.com/tech/terminal.css><link rel="shortcut icon" href=https://chejinying.com/tech/favicon.png><link rel=apple-touch-icon href=https://chejinying.com/tech/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="CPU"><meta property="og:description" content="Linux CPU Overview"><meta property="og:url" content="https://chejinying.com/tech/posts/cpu/"><meta property="og:site_name" content><meta property="og:image" content="https://chejinying.com/tech/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2023-10-16 22:54:48 +0800 +0800"></head><body><div class="container center"><header class=header><div class=header__inner><div class=header__logo><a href=https://chejinying.com/tech/><div class=logo>jinying-che:~#</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=https://chejinying.com/tech/posts>Home</a></li><li><a href=https://chejinying.com/tech/tags>Tags</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=https://chejinying.com/tech/posts>Home</a></li><li><a href=https://chejinying.com/tech/tags>Tags</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://chejinying.com/tech/posts/cpu/>CPU</a></h1><div class=post-meta><time class=post-date>2023-10-16</time></div><span class=post-tags>#<a href=https://chejinying.com/tech/tags/linux/>linux</a>&nbsp;</span><div class=post-content><div><h2 id=process-vs-thread>Process vs Thread<a href=#process-vs-thread class=hanchor arialabel=Anchor>#</a></h2><p>TBD</p><h2 id=troubleshooting>Troubleshooting<a href=#troubleshooting class=hanchor arialabel=Anchor>#</a></h2><p><img src=https://chejinying.com/tech/images/cpu_tools.png alt=overview></p><h4 id=0-procstat>0 /proc/stat<a href=#0-procstat class=hanchor arialabel=Anchor>#</a></h4><h4 id=1-top>1. top<a href=#1-top class=hanchor arialabel=Anchor>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ top
</span></span><span class=line><span class=cl>top - 17:18:53 up <span class=m>50</span> days, 16:06,  <span class=m>7</span> users,  load average: 0.00, 0.00, 0.00
</span></span><span class=line><span class=cl>Tasks: <span class=m>127</span> total,   <span class=m>1</span> running, <span class=m>126</span> sleeping,   <span class=m>0</span> stopped,   <span class=m>0</span> zombie
</span></span><span class=line><span class=cl>%Cpu<span class=o>(</span>s<span class=o>)</span>:  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
</span></span><span class=line><span class=cl>MiB Mem :    957.5 total,    122.6 free,    162.0 used,    673.0 buff/cache
</span></span><span class=line><span class=cl>MiB Swap:   2400.0 total,   2282.0 free,    118.0 used.    622.7 avail Mem
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
</span></span><span class=line><span class=cl> <span class=m>782513</span> root      <span class=m>20</span>   <span class=m>0</span>   <span class=m>17312</span>  <span class=m>11036</span>   <span class=m>8652</span> S   0.3   1.1   0:00.04 sshd
</span></span><span class=line><span class=cl>      <span class=m>1</span> root      <span class=m>20</span>   <span class=m>0</span>  <span class=m>167728</span>   <span class=m>9424</span>   <span class=m>6504</span> S   0.0   1.0   3:05.88 systemd
</span></span><span class=line><span class=cl>      <span class=m>2</span> root      <span class=m>20</span>   <span class=m>0</span>       <span class=m>0</span>      <span class=m>0</span>      <span class=m>0</span> S   0.0   0.0   0:00.66 kthreadd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># man top to get top details, simple put:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># load average : the average number of processes that are either in a runnable or uninterruptable state for the past 1, 5, and 15 minutes. </span>
</span></span><span class=line><span class=cl><span class=c1># e.g. `load average = 1.5` in 6 cpu system means 1/4 cpu is under laod, 3/4 cpu is idle</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># us, user     : time running un-niced user processes</span>
</span></span><span class=line><span class=cl><span class=c1># sy, system   : time running kernel processes</span>
</span></span><span class=line><span class=cl><span class=c1># ni, nice     : time running niced user processes (process priority, a negative nice value means higher priority, whereas a positive nice value means lower priority)</span>
</span></span><span class=line><span class=cl><span class=c1># id, idle     : time spent in the kernel idle handler</span>
</span></span><span class=line><span class=cl><span class=c1># wa, IO-wait  : time waiting for I/O completion</span>
</span></span><span class=line><span class=cl><span class=c1># hi           : time spent servicing hardware interrupts</span>
</span></span><span class=line><span class=cl><span class=c1># si           : time spent servicing software interrupts</span>
</span></span><span class=line><span class=cl><span class=c1># st           : time stolen from this vm by the hypervisor</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># PR: The scheduling priority of the task (real priority of a process as seen by the kernel)</span>
</span></span><span class=line><span class=cl><span class=c1># NI: The nice value of the task (a priority hint for the kernel)</span>
</span></span><span class=line><span class=cl><span class=c1># VIRT: The total amount of virtual memory used by the task (physical memory + swap)</span>
</span></span><span class=line><span class=cl><span class=c1># RES: A subset of the virtual address space (VIRT) representing the non-swapped physical memory (only physical memory)</span>
</span></span><span class=line><span class=cl><span class=c1># SHR: A subset of resident memory (RES) that may be used by other processes</span>
</span></span><span class=line><span class=cl><span class=c1># S: Process Status, the status of the task which can be one of:</span>
</span></span><span class=line><span class=cl><span class=c1>#       D = uninterruptible sleep</span>
</span></span><span class=line><span class=cl><span class=c1>#       I = idle</span>
</span></span><span class=line><span class=cl><span class=c1>#       R = running</span>
</span></span><span class=line><span class=cl><span class=c1>#       S = sleeping</span>
</span></span><span class=line><span class=cl><span class=c1>#       T = stopped by job control signal</span>
</span></span><span class=line><span class=cl><span class=c1>#       t = stopped by debugger during trace</span>
</span></span><span class=line><span class=cl><span class=c1>#       Z = zombie</span>
</span></span></code></pre></div><h4 id=2-vmstat>2. vmstat<a href=#2-vmstat class=hanchor arialabel=Anchor>#</a></h4><p>vmstat reports information about processes, memory, paging, block IO, traps, disks and cpu activity</p><p>refer to <a href=https://jinying-che.github.io/posts/memory/#3-vmstat>details</a></p><h4 id=3-pidstat-process-level>3. pidstat (process level)<a href=#3-pidstat-process-level class=hanchor arialabel=Anchor>#</a></h4><p><code>pidstat</code> report statistics (cpu, memory, disk, stack) for Linux tasks (process), by defaut is cpu utilization without params.</p><ul><li><code>-d</code> Report I/O statistics</li><li><code>-R</code> Report realtime priority and scheduling policy information.</li><li><code>-r</code> Report page faults and memory utilization.</li><li><code>-s</code> Report stack utilization.</li><li><code>-u</code> Report CPU utilization</li><li><code>-v</code> Report values of some kernel tables.</li><li><code>-w</code> Report task switching activity</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># Display 2 reports of CPU statistics for every active task in the system per second intervals.</span>
</span></span><span class=line><span class=cl>$ pidstat <span class=m>1</span> <span class=m>2</span>
</span></span><span class=line><span class=cl>05:31:13 PM   UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command
</span></span><span class=line><span class=cl>05:31:14 PM     <span class=m>0</span>    <span class=m>798270</span>    0.00    1.00    0.00    0.00    1.00     <span class=m>0</span>  pidstat
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>05:31:14 PM   UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Average:      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command
</span></span><span class=line><span class=cl>Average:        <span class=m>0</span>    <span class=m>798270</span>    0.00    0.50    0.00    0.00    0.50     -  pidstat
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># -p Select tasks (processes) for which statistics are to be reported </span>
</span></span><span class=line><span class=cl>$ pidstat -p <span class=m>655152</span> <span class=m>2</span> <span class=m>3</span>
</span></span><span class=line><span class=cl>05:38:56 PM   UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command
</span></span><span class=line><span class=cl>05:38:58 PM     <span class=m>0</span>    <span class=m>655152</span>    0.00    0.00    0.00    0.00    0.00     <span class=m>0</span>  node_exporter
</span></span><span class=line><span class=cl>05:39:00 PM     <span class=m>0</span>    <span class=m>655152</span>    0.00    0.00    0.00    0.00    0.00     <span class=m>0</span>  node_exporter
</span></span><span class=line><span class=cl>05:39:02 PM     <span class=m>0</span>    <span class=m>655152</span>    0.00    0.00    0.00    0.00    0.00     <span class=m>0</span>  node_exporter
</span></span><span class=line><span class=cl>Average:        <span class=m>0</span>    <span class=m>655152</span>    0.00    0.00    0.00    0.00    0.00     -  node_exporter
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># man pidstat for details, simple put</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># PID     The identification number of the task being monitored.</span>
</span></span><span class=line><span class=cl><span class=c1># %usr    Percentage of CPU used by the task while executing at the user level (application)</span>
</span></span><span class=line><span class=cl><span class=c1># %system Percentage of CPU used by the task while executing at the system level (kernel).</span>
</span></span><span class=line><span class=cl><span class=c1># %guest  Percentage of CPU spent by the task in virtual machine (running a virtual processor)</span>
</span></span><span class=line><span class=cl><span class=c1># %wait   Percentage of CPU spent by the task while waiting to run.</span>
</span></span><span class=line><span class=cl><span class=c1># %CPU    Total percentage of CPU time used by the task. </span>
</span></span><span class=line><span class=cl><span class=c1># CPU     Processor number to which the task is attached.</span>
</span></span><span class=line><span class=cl><span class=c1># Command The command name of the task.</span>
</span></span></code></pre></div><h4 id=4-mpstat-cpu-level>4. mpstat (cpu level)<a href=#4-mpstat-cpu-level class=hanchor arialabel=Anchor>#</a></h4><p>mpstat - Report <strong>processors</strong> related statistics.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># Display 2 reports of statistics for all processors at 1 second intervals.</span>
</span></span><span class=line><span class=cl>$ mpstat -P ALL <span class=m>1</span> <span class=m>2</span>
</span></span><span class=line><span class=cl>11:43:14 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
</span></span><span class=line><span class=cl>11:43:15 PM  all    1.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   99.00
</span></span><span class=line><span class=cl>11:43:15 PM    <span class=m>0</span>    1.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   99.00
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>11:43:15 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
</span></span><span class=line><span class=cl>11:43:16 PM  all    1.02    0.00    1.02    0.00    0.00    0.00    0.00    0.00    0.00   97.96
</span></span><span class=line><span class=cl>11:43:16 PM    <span class=m>0</span>    1.02    0.00    1.02    0.00    0.00    0.00    0.00    0.00    0.00   97.96
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Average:     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
</span></span><span class=line><span class=cl>Average:     all    1.01    0.00    0.51    0.00    0.00    0.00    0.00    0.00    0.00   98.48
</span></span><span class=line><span class=cl>Average:       <span class=m>0</span>    1.01    0.00    0.51    0.00    0.00    0.00    0.00    0.00    0.00   98.48
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># man mpstat for details, simple put</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># %usr     Show the percentage of CPU utilization that occurred while executing at the user level (application).</span>
</span></span><span class=line><span class=cl><span class=c1># %nice    Show the percentage of CPU utilization that occurred while executing at the user level with nice priority.</span>
</span></span><span class=line><span class=cl><span class=c1># %sys     Show the percentage of CPU utilization that occurred while executing at the system level (kernel). Note that this does not include time spent servicing hardware and software interrupts.</span>
</span></span><span class=line><span class=cl><span class=c1># %iowait  Show the percentage of time that the CPU or CPUs were idle during which the system had an  outstanding disk I/O request.</span>
</span></span><span class=line><span class=cl><span class=c1># %irq     Show the percentage of time spent by the CPU or CPUs to service hardware interrupts.</span>
</span></span><span class=line><span class=cl><span class=c1># %soft    Show the percentage of time spent by the CPU or CPUs to service software interrupts.</span>
</span></span><span class=line><span class=cl><span class=c1># %steal   Show the percentage of time spent in involuntary wait by the virtual CPU or CPUs while the hypervisor was servicing another virtual processor.</span>
</span></span><span class=line><span class=cl><span class=c1># %guest   Show the percentage of time spent by the CPU or CPUs to run a virtual processor.</span>
</span></span><span class=line><span class=cl><span class=c1># %gnice   Show the percentage of time spent by the CPU or CPUs to run a niced guest.</span>
</span></span><span class=line><span class=cl><span class=c1># %idle    Show the percentage of time that the CPU or CPUs were idle and the system did not have an  outstanding disk I/O request.</span>
</span></span></code></pre></div><h4 id=5-perf>5. perf<a href=#5-perf class=hanchor arialabel=Anchor>#</a></h4><p>Performance analysis tools for Linux (TBD after the actual usage)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># install perf in linux (with root)</span>
</span></span><span class=line><span class=cl>$ apt-get install linux-tools-common linux-tools-generic linux-tools-<span class=sb>`</span>uname -r<span class=sb>`</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ perf top
</span></span><span class=line><span class=cl>Samples: 22K of event <span class=s1>&#39;cycles&#39;</span>, <span class=m>4000</span> Hz, Event count <span class=o>(</span>approx.<span class=o>)</span>: <span class=m>1228941005</span> lost: 0/0 drop: 0/734
</span></span><span class=line><span class=cl>Overhead  Shared Object                                                   Symbol
</span></span><span class=line><span class=cl>  14.88%  perf                                                            <span class=o>[</span>.<span class=o>]</span> __symbols__insert
</span></span><span class=line><span class=cl>   9.56%  perf                                                            <span class=o>[</span>.<span class=o>]</span> rb_next
</span></span><span class=line><span class=cl>   1.74%  perf                                                            <span class=o>[</span>.<span class=o>]</span> rust_demangle_callback
</span></span><span class=line><span class=cl>   1.53%  perf                                                            <span class=o>[</span>.<span class=o>]</span> output_resort
</span></span><span class=line><span class=cl>   1.44%  perf                                                            <span class=o>[</span>.<span class=o>]</span> dso__find_symbol
</span></span><span class=line><span class=cl>   1.23%  perf                                                            <span class=o>[</span>.<span class=o>]</span> rb_insert_color
</span></span><span class=line><span class=cl>   1.04%  <span class=o>[</span>kernel<span class=o>]</span>                                                        <span class=o>[</span>k<span class=o>]</span> clear_page_rep
</span></span><span class=line><span class=cl>   0.89%  perf                                                            <span class=o>[</span>.<span class=o>]</span> hist_entry__sort
</span></span><span class=line><span class=cl>   0.88%  perf                                                            <span class=o>[</span>.<span class=o>]</span> hpp__sort_overhead
</span></span><span class=line><span class=cl>   0.88%  <span class=o>[</span>kernel<span class=o>]</span>                                                        <span class=o>[</span>k<span class=o>]</span> asm_sysvec_apic_timer_interrupt
</span></span><span class=line><span class=cl>   0.82%  libslang.so.2.3.2                                               <span class=o>[</span>.<span class=o>]</span> SLsmg_write_chars
</span></span><span class=line><span class=cl>   0.66%  libc.so.6                                                       <span class=o>[</span>.<span class=o>]</span> cfree
</span></span><span class=line><span class=cl>   0.63%  libc.so.6                                                       <span class=o>[</span>.<span class=o>]</span> 0x00000000000a1747
</span></span><span class=line><span class=cl>   0.60%  sshd                                                            <span class=o>[</span>.<span class=o>]</span> 0x000000000006228c
</span></span><span class=line><span class=cl>   0.57%  <span class=o>[</span>kernel<span class=o>]</span>                                                        <span class=o>[</span>k<span class=o>]</span> memcpy_toio
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># -g Enables call-graph (stack chain/backtrace) recording</span>
</span></span><span class=line><span class=cl>$ perf top -g -p <span class=m>655152</span>
</span></span></code></pre></div><h4 id=6-strace>6. strace<a href=#6-strace class=hanchor arialabel=Anchor>#</a></h4><p>strace - trace system calls and signals, refer to <a href=https://jinying-che.github.io/posts/file_system/#5-strace>details</a></p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><a href=https://chejinying.com/tech/posts/cap/ class="button inline prev">&lt; [<span class=button__text>CAP</span>]
</a>::
<a href=https://chejinying.com/tech/posts/file_system/ class="button inline next">[<span class=button__text>File System</span>] ></a></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=https://chejinying.com/tech/bundle.min.js></script></div></body></html>