<!doctype html><html lang=en><head><title>CPU :: </title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Linux CPU Overview"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://jinying-che.github.io/posts/cpu/><link rel=stylesheet href=https://jinying-che.github.io/styles.css><link rel="shortcut icon" href=https://jinying-che.github.io/img/theme-colors/green.png><link rel=apple-touch-icon href=https://jinying-che.github.io/img/theme-colors/green.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="CPU"><meta property="og:description" content="Linux CPU Overview"><meta property="og:url" content="https://jinying-che.github.io/posts/cpu/"><meta property="og:site_name" content><meta property="og:image" content="https://jinying-che.github.io/img/favicon/green.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2023-10-16 22:54:48 +0800 +0800"></head><body class=green><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>jinying-che:~#</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/posts>Home</a></li><li><a href=/tags>Tags</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/posts>Home</a></li><li><a href=/tags>Tags</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://jinying-che.github.io/posts/cpu/>CPU</a></h1><div class=post-meta><time class=post-date>2023-10-16 ::</time></div><span class=post-tags>#<a href=https://jinying-che.github.io/tags/linux/>linux</a>&nbsp;</span><div class=post-content><div><h2 id=process-vs-thread>Process vs Thread<a href=#process-vs-thread class=hanchor arialabel=Anchor>&#8983;</a></h2><p>TBD</p><h2 id=troubleshooting>Troubleshooting<a href=#troubleshooting class=hanchor arialabel=Anchor>&#8983;</a></h2><p><img alt=overview src=/images/cpu_tools.png></p><h4 id=0-procstat>0 /proc/stat<a href=#0-procstat class=hanchor arialabel=Anchor>&#8983;</a></h4><h4 id=1-top>1. top<a href=#1-top class=hanchor arialabel=Anchor>&#8983;</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ top
</span></span><span style=display:flex><span>top - 17:18:53 up <span style=color:#ae81ff>50</span> days, 16:06,  <span style=color:#ae81ff>7</span> users,  load average: 0.00, 0.00, 0.00
</span></span><span style=display:flex><span>Tasks: <span style=color:#ae81ff>127</span> total,   <span style=color:#ae81ff>1</span> running, <span style=color:#ae81ff>126</span> sleeping,   <span style=color:#ae81ff>0</span> stopped,   <span style=color:#ae81ff>0</span> zombie
</span></span><span style=display:flex><span>%Cpu<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span>:  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
</span></span><span style=display:flex><span>MiB Mem :    957.5 total,    122.6 free,    162.0 used,    673.0 buff/cache
</span></span><span style=display:flex><span>MiB Swap:   2400.0 total,   2282.0 free,    118.0 used.    622.7 avail Mem
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
</span></span><span style=display:flex><span> <span style=color:#ae81ff>782513</span> root      <span style=color:#ae81ff>20</span>   <span style=color:#ae81ff>0</span>   <span style=color:#ae81ff>17312</span>  <span style=color:#ae81ff>11036</span>   <span style=color:#ae81ff>8652</span> S   0.3   1.1   0:00.04 sshd
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>1</span> root      <span style=color:#ae81ff>20</span>   <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>167728</span>   <span style=color:#ae81ff>9424</span>   <span style=color:#ae81ff>6504</span> S   0.0   1.0   3:05.88 systemd
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>2</span> root      <span style=color:#ae81ff>20</span>   <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> S   0.0   0.0   0:00.66 kthreadd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># man top to get top details, simple put:</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># load average : the average number of processes that are either in a runnable or uninterruptable state for the past 1, 5, and 15 minutes. </span>
</span></span><span style=display:flex><span><span style=color:#75715e># e.g. `load average = 1.5` in 6 cpu system means 1/4 cpu is under laod, 3/4 cpu is idle</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># us, user     : time running un-niced user processes</span>
</span></span><span style=display:flex><span><span style=color:#75715e># sy, system   : time running kernel processes</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ni, nice     : time running niced user processes (process priority, a negative nice value means higher priority, whereas a positive nice value means lower priority)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># id, idle     : time spent in the kernel idle handler</span>
</span></span><span style=display:flex><span><span style=color:#75715e># wa, IO-wait  : time waiting for I/O completion</span>
</span></span><span style=display:flex><span><span style=color:#75715e># hi           : time spent servicing hardware interrupts</span>
</span></span><span style=display:flex><span><span style=color:#75715e># si           : time spent servicing software interrupts</span>
</span></span><span style=display:flex><span><span style=color:#75715e># st           : time stolen from this vm by the hypervisor</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># PR: The scheduling priority of the task (real priority of a process as seen by the kernel)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># NI: The nice value of the task (a priority hint for the kernel)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># VIRT: The total amount of virtual memory used by the task (physical memory + swap)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># RES: A subset of the virtual address space (VIRT) representing the non-swapped physical memory (only physical memory)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># SHR: A subset of resident memory (RES) that may be used by other processes</span>
</span></span><span style=display:flex><span><span style=color:#75715e># S: Process Status, the status of the task which can be one of:</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#       D = uninterruptible sleep</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#       I = idle</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#       R = running</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#       S = sleeping</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#       T = stopped by job control signal</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#       t = stopped by debugger during trace</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#       Z = zombie</span>
</span></span></code></pre></div><h4 id=2-vmstat>2. vmstat<a href=#2-vmstat class=hanchor arialabel=Anchor>&#8983;</a></h4><p>vmstat reports information about processes, memory, paging, block IO, traps, disks and cpu activity</p><p>refer to <a href=https://jinying-che.github.io/posts/memory/#3-vmstat>details</a></p><h4 id=3-pidstat-process-level>3. pidstat (process level)<a href=#3-pidstat-process-level class=hanchor arialabel=Anchor>&#8983;</a></h4><p><code>pidstat</code> report statistics (cpu, memory, disk, stack) for Linux tasks (process), by defaut is cpu utilization without params.</p><ul><li><code>-d</code> Report I/O statistics</li><li><code>-R</code> Report realtime priority and scheduling policy information.</li><li><code>-r</code> Report page faults and memory utilization.</li><li><code>-s</code> Report stack utilization.</li><li><code>-u</code> Report CPU utilization</li><li><code>-v</code> Report values of some kernel tables.</li><li><code>-w</code> Report task switching activity</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># Display 2 reports of CPU statistics for every active task in the system per second intervals.</span>
</span></span><span style=display:flex><span>$ pidstat <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>05:31:13 PM   UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command
</span></span><span style=display:flex><span>05:31:14 PM     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>798270</span>    0.00    1.00    0.00    0.00    1.00     <span style=color:#ae81ff>0</span>  pidstat
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>05:31:14 PM   UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Average:      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command
</span></span><span style=display:flex><span>Average:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>798270</span>    0.00    0.50    0.00    0.00    0.50     -  pidstat
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># -p Select tasks (processes) for which statistics are to be reported </span>
</span></span><span style=display:flex><span>$ pidstat -p <span style=color:#ae81ff>655152</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>05:38:56 PM   UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command
</span></span><span style=display:flex><span>05:38:58 PM     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>655152</span>    0.00    0.00    0.00    0.00    0.00     <span style=color:#ae81ff>0</span>  node_exporter
</span></span><span style=display:flex><span>05:39:00 PM     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>655152</span>    0.00    0.00    0.00    0.00    0.00     <span style=color:#ae81ff>0</span>  node_exporter
</span></span><span style=display:flex><span>05:39:02 PM     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>655152</span>    0.00    0.00    0.00    0.00    0.00     <span style=color:#ae81ff>0</span>  node_exporter
</span></span><span style=display:flex><span>Average:        <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>655152</span>    0.00    0.00    0.00    0.00    0.00     -  node_exporter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># man pidstat for details, simple put</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># PID     The identification number of the task being monitored.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># %usr    Percentage of CPU used by the task while executing at the user level (application)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># %system Percentage of CPU used by the task while executing at the system level (kernel).</span>
</span></span><span style=display:flex><span><span style=color:#75715e># %guest  Percentage of CPU spent by the task in virtual machine (running a virtual processor)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># %wait   Percentage of CPU spent by the task while waiting to run.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># %CPU    Total percentage of CPU time used by the task. </span>
</span></span><span style=display:flex><span><span style=color:#75715e># CPU     Processor number to which the task is attached.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Command The command name of the task.</span>
</span></span></code></pre></div><h4 id=4-mpstat-cpu-level>4. mpstat (cpu level)<a href=#4-mpstat-cpu-level class=hanchor arialabel=Anchor>&#8983;</a></h4><p>mpstat - Report <strong>processors</strong> related statistics.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># Display 2 reports of statistics for all processors at 1 second intervals.</span>
</span></span><span style=display:flex><span>$ mpstat -P ALL <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>11:43:14 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
</span></span><span style=display:flex><span>11:43:15 PM  all    1.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   99.00
</span></span><span style=display:flex><span>11:43:15 PM    <span style=color:#ae81ff>0</span>    1.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   99.00
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>11:43:15 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
</span></span><span style=display:flex><span>11:43:16 PM  all    1.02    0.00    1.02    0.00    0.00    0.00    0.00    0.00    0.00   97.96
</span></span><span style=display:flex><span>11:43:16 PM    <span style=color:#ae81ff>0</span>    1.02    0.00    1.02    0.00    0.00    0.00    0.00    0.00    0.00   97.96
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Average:     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
</span></span><span style=display:flex><span>Average:     all    1.01    0.00    0.51    0.00    0.00    0.00    0.00    0.00    0.00   98.48
</span></span><span style=display:flex><span>Average:       <span style=color:#ae81ff>0</span>    1.01    0.00    0.51    0.00    0.00    0.00    0.00    0.00    0.00   98.48
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># man mpstat for details, simple put</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># %usr     Show the percentage of CPU utilization that occurred while executing at the user level (application).</span>
</span></span><span style=display:flex><span><span style=color:#75715e># %nice    Show the percentage of CPU utilization that occurred while executing at the user level with nice priority.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># %sys     Show the percentage of CPU utilization that occurred while executing at the system level (kernel). Note that this does not include time spent servicing hardware and software interrupts.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># %iowait  Show the percentage of time that the CPU or CPUs were idle during which the system had an  outstanding disk I/O request.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># %irq     Show the percentage of time spent by the CPU or CPUs to service hardware interrupts.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># %soft    Show the percentage of time spent by the CPU or CPUs to service software interrupts.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># %steal   Show the percentage of time spent in involuntary wait by the virtual CPU or CPUs while the hypervisor was servicing another virtual processor.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># %guest   Show the percentage of time spent by the CPU or CPUs to run a virtual processor.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># %gnice   Show the percentage of time spent by the CPU or CPUs to run a niced guest.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># %idle    Show the percentage of time that the CPU or CPUs were idle and the system did not have an  outstanding disk I/O request.</span>
</span></span></code></pre></div><h4 id=5-perf>5. perf<a href=#5-perf class=hanchor arialabel=Anchor>&#8983;</a></h4><p>Performance analysis tools for Linux (TBD after the actual usage)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># install perf in linux (with root)</span>
</span></span><span style=display:flex><span>$ apt-get install linux-tools-common linux-tools-generic linux-tools-<span style=color:#e6db74>`</span>uname -r<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ perf top
</span></span><span style=display:flex><span>Samples: 22K of event <span style=color:#e6db74>&#39;cycles&#39;</span>, <span style=color:#ae81ff>4000</span> Hz, Event count <span style=color:#f92672>(</span>approx.<span style=color:#f92672>)</span>: <span style=color:#ae81ff>1228941005</span> lost: 0/0 drop: 0/734
</span></span><span style=display:flex><span>Overhead  Shared Object                                                   Symbol
</span></span><span style=display:flex><span>  14.88%  perf                                                            <span style=color:#f92672>[</span>.<span style=color:#f92672>]</span> __symbols__insert
</span></span><span style=display:flex><span>   9.56%  perf                                                            <span style=color:#f92672>[</span>.<span style=color:#f92672>]</span> rb_next
</span></span><span style=display:flex><span>   1.74%  perf                                                            <span style=color:#f92672>[</span>.<span style=color:#f92672>]</span> rust_demangle_callback
</span></span><span style=display:flex><span>   1.53%  perf                                                            <span style=color:#f92672>[</span>.<span style=color:#f92672>]</span> output_resort
</span></span><span style=display:flex><span>   1.44%  perf                                                            <span style=color:#f92672>[</span>.<span style=color:#f92672>]</span> dso__find_symbol
</span></span><span style=display:flex><span>   1.23%  perf                                                            <span style=color:#f92672>[</span>.<span style=color:#f92672>]</span> rb_insert_color
</span></span><span style=display:flex><span>   1.04%  <span style=color:#f92672>[</span>kernel<span style=color:#f92672>]</span>                                                        <span style=color:#f92672>[</span>k<span style=color:#f92672>]</span> clear_page_rep
</span></span><span style=display:flex><span>   0.89%  perf                                                            <span style=color:#f92672>[</span>.<span style=color:#f92672>]</span> hist_entry__sort
</span></span><span style=display:flex><span>   0.88%  perf                                                            <span style=color:#f92672>[</span>.<span style=color:#f92672>]</span> hpp__sort_overhead
</span></span><span style=display:flex><span>   0.88%  <span style=color:#f92672>[</span>kernel<span style=color:#f92672>]</span>                                                        <span style=color:#f92672>[</span>k<span style=color:#f92672>]</span> asm_sysvec_apic_timer_interrupt
</span></span><span style=display:flex><span>   0.82%  libslang.so.2.3.2                                               <span style=color:#f92672>[</span>.<span style=color:#f92672>]</span> SLsmg_write_chars
</span></span><span style=display:flex><span>   0.66%  libc.so.6                                                       <span style=color:#f92672>[</span>.<span style=color:#f92672>]</span> cfree
</span></span><span style=display:flex><span>   0.63%  libc.so.6                                                       <span style=color:#f92672>[</span>.<span style=color:#f92672>]</span> 0x00000000000a1747
</span></span><span style=display:flex><span>   0.60%  sshd                                                            <span style=color:#f92672>[</span>.<span style=color:#f92672>]</span> 0x000000000006228c
</span></span><span style=display:flex><span>   0.57%  <span style=color:#f92672>[</span>kernel<span style=color:#f92672>]</span>                                                        <span style=color:#f92672>[</span>k<span style=color:#f92672>]</span> memcpy_toio
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># -g Enables call-graph (stack chain/backtrace) recording</span>
</span></span><span style=display:flex><span>$ perf top -g -p <span style=color:#ae81ff>655152</span>
</span></span></code></pre></div><h4 id=6-strace>6. strace<a href=#6-strace class=hanchor arialabel=Anchor>&#8983;</a></h4><p>strace - trace system calls and signals, refer to <a href=https://jinying-che.github.io/posts/file_system/#5-strace>details</a></p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://jinying-che.github.io/posts/cap/><span class=button__icon>←</span>
<span class=button__text>CAP</span>
</a></span><span class="button next"><a href=https://jinying-che.github.io/posts/file_system/><span class=button__text>File System</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>