<!doctype html><html lang=en><head><title>alerting rule: grafana vs vmalert :: </title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="how alerting rule is implemented in grafana and vmalert"><meta name=keywords content="computer,ai,network"><meta name=robots content="noodp"><link rel=canonical href=https://jinying-che.github.io/posts/alerting_rule/><link rel=stylesheet href=https://jinying-che.github.io/styles.css><link rel="shortcut icon" href=https://jinying-che.github.io/img/theme-colors/green.png><link rel=apple-touch-icon href=https://jinying-che.github.io/img/theme-colors/green.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="alerting rule: grafana vs vmalert"><meta property="og:description" content="how alerting rule is implemented in grafana and vmalert"><meta property="og:url" content="https://jinying-che.github.io/posts/alerting_rule/"><meta property="og:site_name" content><meta property="og:image" content="https://jinying-che.github.io/img/favicon/green.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2024-11-24 16:19:22 +0800 +0800"></head><body class=green><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>jinying-che:~#</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;â–¾</li><li><ul class=menu__dropdown><li><a href=/posts>Home</a></li><li><a href=/tags>Tags</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/posts>Home</a></li><li><a href=/tags>Tags</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://jinying-che.github.io/posts/alerting_rule/>alerting rule: grafana vs vmalert</a></h1><div class=post-meta><time class=post-date>2024-11-24 ::</time></div><span class=post-tags>#<a href=https://jinying-che.github.io/tags/grafana/>grafana</a>&nbsp;
#<a href=https://jinying-che.github.io/tags/vmalert/>vmalert</a>&nbsp;</span><div class=post-content><div><p>Let&rsquo;s try to understand how alerting rule is implemented in two open source projects: <strong>grafana</strong> and <strong>vmalert</strong>.</p><h1 id=version>Version<a href=#version class=hanchor arialabel=Anchor>&#8983;</a></h1><p>use the latest version of the according source code:</p><ul><li>grafana <a href=https://github.com/grafana/grafana/tree/v11.3.1>v11.3.1</a></li><li>vmalert <a href=https://github.com/VictoriaMetrics/VictoriaMetrics/tree/v1.106.1>v1.106.1</a></li></ul><h1 id=flow>Flow<a href=#flow class=hanchor arialabel=Anchor>&#8983;</a></h1><h3 id=grafana>grafana<a href=#grafana class=hanchor arialabel=Anchor>&#8983;</a></h3><p><img alt="grafana alert" src=/images/grafana_alert.png></p><ul><li>Scheduler -> fetch alerting rules -> start <em>goroutine</em> for each alerting rule<ul><li><code>pkg/services/ngalert/schedule/schedule.go:280</code></li></ul></li><li>Scheduler -> send evaluation event(when internal elapsed) -> goroutine -> evaluation<ul><li><code>pkg/services/ngalert/schedule/alert_rule.go:242</code></li></ul></li><li>Schedduler -> stop the goroutine (alerting rule delted) according to the heartbeat<ul><li><code>pkg/services/ngalert/schedule/alert_rule.go:355</code></li></ul></li></ul><h3 id=vmalert>vmalert<a href=#vmalert class=hanchor arialabel=Anchor>&#8983;</a></h3><p><img alt=vmalert src=/images/vmalert.png></p><ul><li>configReload (cron job by configCheckInterval) -> loading alerting rule files -> <code>[]config.Group</code></li><li><code>[]config.Group</code> -> diff -> manager -> <strong>start</strong> the new <code>rule.Group</code> and <strong>delete</strong> the old <code>rule.Group</code></li><li>start <code>rule.Group</code> per <em>goroutine</em> -> executor -> execConcurrently (<code>[]rule.Rule</code>) -> rule.exec() per <em>goroutine</em></li></ul><h1 id=evaluation>Evaluation<a href=#evaluation class=hanchor arialabel=Anchor>&#8983;</a></h1><h3 id=grafana-1>grafana<a href=#grafana-1 class=hanchor arialabel=Anchor>&#8983;</a></h3><blockquote><p>code entrance: <code>pkg/services/ngalert/schedule/alert_rule.go:327</code></p></blockquote><p>evalCh -> event -> alertRule -> evaluate:</p><ul><li>eval.EvaluatorFactory -> create -> ConditionEvaluator (<code>BuildPipeline -> buildDependencyGraph -> buildExecutionOrder -> []Node</code>)</li><li>ConditionEvaluator -> Evaluate<ul><li>expressionExecutor -> ExecutePipeline (DataPipeline []Node)<ul><li>DataPipeline -> excute -> for loop []Node -> backend.QueryDataResponse</li></ul></li><li>backend.QueryDataResponse -> EvaluateAlert -> Results</li></ul></li><li>Results -> stateManager.ProcessEvalResults</li></ul><h3 id=vmalert-1>vmalert<a href=#vmalert-1 class=hanchor arialabel=Anchor>&#8983;</a></h3><blockquote><p>code entrance: <code>app/vmalert/rule/group.go:311</code></p></blockquote><p>rule.Group -> exec(rule.Rule) concurrently:</p><ul><li>executor instant query (for now) -> response (label set of Metric that needs alerting)<ul><li>response -> update AlertingRule.alerts</li></ul></li><li>alerts -> executor.Notifier</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Querier interface wraps Query and QueryRange methods
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Querier</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Query is used for the rule evaluation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>Query</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>query</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>ts</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>) (<span style=color:#a6e22e>Result</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e>// QueryRange is used for rule replay 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>QueryRange</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>query</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>from</span>, <span style=color:#a6e22e>to</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>) (<span style=color:#a6e22e>Result</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=data-structure>Data Structure<a href=#data-structure class=hanchor arialabel=Anchor>&#8983;</a></h1><h3 id=grafana-2>grafana<a href=#grafana-2 class=hanchor arialabel=Anchor>&#8983;</a></h3><p>alert rule</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// pkg/services/ngalert/models/alert_rule.go:247
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// AlertRule is the model for alert rules in unified alerting.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>AlertRule</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ID</span>              <span style=color:#66d9ef>int64</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>OrgID</span>           <span style=color:#66d9ef>int64</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Title</span>           <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Condition</span>       <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Data</span>            []<span style=color:#a6e22e>AlertQuery</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Updated</span>         <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>IntervalSeconds</span> <span style=color:#66d9ef>int64</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Version</span>         <span style=color:#66d9ef>int64</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>UID</span>             <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>NamespaceUID</span>    <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>DashboardUID</span>    <span style=color:#f92672>*</span><span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>PanelID</span>         <span style=color:#f92672>*</span><span style=color:#66d9ef>int64</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>RuleGroup</span>       <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>RuleGroupIndex</span>  <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Record</span>          <span style=color:#f92672>*</span><span style=color:#a6e22e>Record</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>NoDataState</span>     <span style=color:#a6e22e>NoDataState</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ExecErrState</span>    <span style=color:#a6e22e>ExecutionErrorState</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// ideally this field should have been apimodels.ApiDuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// but this is currently not possible because of circular dependencies
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>For</span>                  <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Annotations</span>          <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Labels</span>               <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>IsPaused</span>             <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>NotificationSettings</span> []<span style=color:#a6e22e>NotificationSettings</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Metadata</span>             <span style=color:#a6e22e>AlertRuleMetadata</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// AlertQuery represents a single query associated with an alert definition.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>AlertQuery</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// RefID is the unique identifier of the query, set by the frontend call.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>RefID</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;refId&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// QueryType is an optional identifier for the type of query.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// It can be used to distinguish different types of queries.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>QueryType</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;queryType&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// RelativeTimeRange is the relative Start and End of the query as sent by the frontend.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>RelativeTimeRange</span> <span style=color:#a6e22e>RelativeTimeRange</span> <span style=color:#e6db74>`json:&#34;relativeTimeRange&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Grafana data source unique identifier; it should be &#39;__expr__&#39; for a Server Side Expression operation.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>DatasourceUID</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;datasourceUid&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// JSON is the raw JSON query and includes the above properties as well as custom properties.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>Model</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>RawMessage</span> <span style=color:#e6db74>`json:&#34;model&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>modelProps</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#a6e22e>any</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Node</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// pkg/expr/graph.go
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> (
</span></span><span style=display:flex><span>	<span style=color:#75715e>// TypeCMDNode is a NodeType for expression commands.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>TypeCMDNode</span> <span style=color:#a6e22e>NodeType</span> = <span style=color:#66d9ef>iota</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// TypeDatasourceNode is a NodeType for datasource queries.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>TypeDatasourceNode</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// TypeMLNode is a NodeType for Machine Learning queries.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>TypeMLNode</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// pkg/expr/nodes.go
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> (
</span></span><span style=display:flex><span>	<span style=color:#75715e>// TypeUnknown is the CMDType for an unrecognized expression type.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>TypeUnknown</span> <span style=color:#a6e22e>CommandType</span> = <span style=color:#66d9ef>iota</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// TypeMath is the CMDType for a math expression.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>TypeMath</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// TypeReduce is the CMDType for a reduction expression.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>TypeReduce</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// TypeResample is the CMDType for a resampling expression.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>TypeResample</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// TypeClassicConditions is the CMDType for the classic condition operation.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>TypeClassicConditions</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// TypeThreshold is the CMDType for checking if a threshold has been crossed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>TypeThreshold</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// TypeSQL is the CMDType for running SQL expressions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>TypeSQL</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><h3 id=vmalert-2>vmalert<a href=#vmalert-2 class=hanchor arialabel=Anchor>&#8983;</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// app/vmalert/rule/alerting.go:24
</span></span></span><span style=display:flex><span><span style=color:#75715e>// AlertingRule is basic alert entity
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>AlertingRule</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Type</span>          <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>Type</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>RuleID</span>        <span style=color:#66d9ef>uint64</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Name</span>          <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Expr</span>          <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>For</span>           <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>KeepFiringFor</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Labels</span>        <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Annotations</span>   <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>GroupID</span>       <span style=color:#66d9ef>uint64</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>GroupName</span>     <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>File</span>          <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>EvalInterval</span>  <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Debug</span>         <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>q</span> <span style=color:#a6e22e>datasource</span>.<span style=color:#a6e22e>Querier</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>alertsMu</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>RWMutex</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// stores list of active alerts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>alerts</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>uint64</span>]<span style=color:#f92672>*</span><span style=color:#a6e22e>notifier</span>.<span style=color:#a6e22e>Alert</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// state stores recent state changes
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// during evaluations
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>state</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>ruleState</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>metrics</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>alertingRuleMetrics</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// app/vmalert/rule/group.go:40
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Group is an entity for grouping rules
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Group</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>mu</span>         <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>RWMutex</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Name</span>       <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>File</span>       <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Rules</span>      []<span style=color:#a6e22e>Rule</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Type</span>       <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>Type</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Interval</span>   <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>EvalOffset</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// EvalDelay will adjust timestamp for rule evaluation requests to compensate intentional query delay from datasource.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// see https://github.com/VictoriaMetrics/VictoriaMetrics/issues/5155
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>EvalDelay</span>      <span style=color:#f92672>*</span><span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Limit</span>          <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Concurrency</span>    <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Checksum</span>       <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>LastEvaluation</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Labels</span>          <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Params</span>          <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>Values</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Headers</span>         <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>NotifierHeaders</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>doneCh</span>     <span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>struct</span>{}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>finishedCh</span> <span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>struct</span>{}
</span></span><span style=display:flex><span>	<span style=color:#75715e>// channel accepts new Group obj
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// which supposed to update current group
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>updateCh</span> <span style=color:#66d9ef>chan</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Group</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// evalCancel stores the cancel fn for interrupting
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// rules evaluation. Used on groups update() and close().
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>evalCancel</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>CancelFunc</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>metrics</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>groupMetrics</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// evalAlignment will make the timestamp of group query
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// requests be aligned with interval
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>evalAlignment</span> <span style=color:#f92672>*</span><span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button next"><a href=https://jinying-che.github.io/posts/vps_setup/><span class=button__text>vps setup</span>
<span class=button__icon>â†’</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>Â© 2024 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>