<!doctype html><html lang=en><head><title>Victorial Metrics ::</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Victorial Metrics"><meta name=keywords content="computer,ai,network"><meta name=robots content="noodp"><link rel=canonical href=https://chejinying.com/tech/posts/vm/victorial_metrics/><link rel=stylesheet href=https://chejinying.com/tech/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://chejinying.com/tech/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://chejinying.com/tech/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://chejinying.com/tech/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://chejinying.com/tech/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://chejinying.com/tech/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://chejinying.com/tech/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css><link rel=stylesheet href=https://chejinying.com/tech/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css><link rel=stylesheet href=https://chejinying.com/tech/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://chejinying.com/tech/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css><link rel=stylesheet href=https://chejinying.com/tech/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css><link rel=stylesheet href=https://chejinying.com/tech/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link rel=stylesheet href=https://chejinying.com/tech/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel=stylesheet href=https://chejinying.com/tech/terminal.css><link rel="shortcut icon" href=https://chejinying.com/tech/favicon.png><link rel=apple-touch-icon href=https://chejinying.com/tech/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Victorial Metrics"><meta property="og:description" content="Victorial Metrics"><meta property="og:url" content="https://chejinying.com/tech/posts/vm/victorial_metrics/"><meta property="og:site_name" content><meta property="og:image" content="https://chejinying.com/tech/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2024-02-13 07:37:29 +0800 +0800"></head><body><div class="container center"><header class=header><div class=header__inner><div class=header__logo><a href=https://chejinying.com/tech/><div class=logo>jinying-che:~#</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=https://chejinying.com/tech/posts>Home</a></li><li><a href=https://chejinying.com/tech/tags>Tags</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=https://chejinying.com/tech/posts>Home</a></li><li><a href=https://chejinying.com/tech/tags>Tags</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://chejinying.com/tech/posts/vm/victorial_metrics/>Victorial Metrics</a></h1><div class=post-meta><time class=post-date>2024-02-13</time></div><span class=post-tags>#<a href=https://chejinying.com/tech/tags/monitor/>monitor</a>&nbsp;
#<a href=https://chejinying.com/tech/tags/victoria-metrics/>victoria metrics</a>&nbsp;</span><div class=post-content><div><h2 id=quick-start>Quick Start<a href=#quick-start class=hanchor arialabel=Anchor>#</a></h2><p><strong>Victoria Metrics</strong></p><ul><li>An easy way to run VictoriaMetrics locally is to build from the <a href=https://docs.victoriametrics.com/single-server-victoriametrics/#how-to-build-from-sources>source code</a> as there&rsquo;re lots of vm binaries like vmselect, vmstorage, vminsert, etc. to download, and all of them are maintained in the same <a href=https://github.com/VictoriaMetrics/VictoriaMetrics>repository</a>, and <code>Makefile</code> is quite straightforward.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone git@github.com:VictoriaMetrics/VictoriaMetrics.git
</span></span><span class=line><span class=cl>make victoria-metrics
</span></span><span class=line><span class=cl>mv /bin/victoria-metrics /usr/bin
</span></span></code></pre></div><ul><li>Run VictoriaMetrics With Systemd
see <a href=https://docs.victoriametrics.com/quick-start/#starting-vm-single-from-a-binary>details</a></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>Unit<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>Description</span><span class=o>=</span><span class=s2>&#34;Victoria Metrics Single&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>Documentation</span><span class=o>=</span>https://https://docs.victoriametrics.com/
</span></span><span class=line><span class=cl><span class=nv>After</span><span class=o>=</span>network.target
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>Service<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>Type</span><span class=o>=</span>simple
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>ExecStart</span><span class=o>=</span>/usr/bin/victoria-metrics-prod <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        -storageDataPath<span class=o>=</span>/data/vm <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        -httpListenAddr<span class=o>=</span>:8428 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        -promscrape.config<span class=o>=</span>/etc/prometheus/scrape.yml
</span></span><span class=line><span class=cl><span class=nv>ExecStop</span><span class=o>=</span>/bin/kill -s SIGTERM <span class=nv>$MAINPID</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>Restart</span><span class=o>=</span>on-failure
</span></span><span class=line><span class=cl><span class=nv>SuccessExitStatus</span><span class=o>=</span><span class=m>0</span>
</span></span><span class=line><span class=cl><span class=nv>LimitNOFILE</span><span class=o>=</span><span class=m>65536</span>
</span></span><span class=line><span class=cl><span class=nv>StandardOutput</span><span class=o>=</span>/var/log/vm/out.log
</span></span><span class=line><span class=cl><span class=nv>StandardError</span><span class=o>=</span>/var/log/vm/err.log
</span></span><span class=line><span class=cl><span class=nv>SyslogIdentifier</span><span class=o>=</span>prometheus
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>Install<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>WantedBy</span><span class=o>=</span>multi-user.target
</span></span></code></pre></div><h2 id=storage>Storage<a href=#storage class=hanchor arialabel=Anchor>#</a></h2><h3 id=on-disk-layout>On Disk Layout<a href=#on-disk-layout class=hanchor arialabel=Anchor>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>./data
</span></span><span class=line><span class=cl>├── big
</span></span><span class=line><span class=cl>│   ├── 2024_01
</span></span><span class=line><span class=cl>│   │   ├── 17A6101707C91B08
</span></span><span class=line><span class=cl>│   │   │   ├── index.bin
</span></span><span class=line><span class=cl>│   │   │   ├── metadata.json
</span></span><span class=line><span class=cl>│   │   │   ├── metaindex.bin
</span></span><span class=line><span class=cl>│   │   │   ├── timestamps.bin
</span></span><span class=line><span class=cl>│   │   │   └── values.bin
</span></span><span class=line><span class=cl>│   ├── 2024_02
</span></span><span class=line><span class=cl>│   ├── ...
</span></span><span class=line><span class=cl>│   └── snapshots
</span></span><span class=line><span class=cl>│       ├── 20240109092239-179E85E399D5EFDA
</span></span><span class=line><span class=cl>│       │   ├── 2023_12
</span></span><span class=line><span class=cl>│       │   └── 2024_01
</span></span><span class=line><span class=cl>│       └── 20240111104529-179E85E399D5EFDB
</span></span><span class=line><span class=cl>│           ├── 2023_12
</span></span><span class=line><span class=cl>│           └── 2024_01
</span></span><span class=line><span class=cl>├── flock.lock
</span></span><span class=line><span class=cl>└── small
</span></span><span class=line><span class=cl>    ├── 2024_01
</span></span><span class=line><span class=cl>    │   ├── 17A6101707CC58EF
</span></span><span class=line><span class=cl>    │   │   ├── index.bin
</span></span><span class=line><span class=cl>    │   │   ├── metadata.json
</span></span><span class=line><span class=cl>    │   │   ├── metaindex.bin
</span></span><span class=line><span class=cl>    │   │   ├── timestamps.bin
</span></span><span class=line><span class=cl>    │   │   └── values.bin
</span></span><span class=line><span class=cl>    └── snapshots
</span></span><span class=line><span class=cl>        ├── 20240109092239-179E85E399D5EFDA
</span></span><span class=line><span class=cl>        │   ├── 2023_12
</span></span><span class=line><span class=cl>        │   └── 2024_01
</span></span><span class=line><span class=cl>        └── 20240111104529-179E85E399D5EFDB
</span></span><span class=line><span class=cl>            ├── 2023_12
</span></span><span class=line><span class=cl>            └── 2024_01
</span></span></code></pre></div><p>For details, see <a href=https://docs.victoriametrics.com/single-server-victoriametrics/#storage>doc</a></p><ul><li>small:</li><li>big:</li><li>flock.lock:</li></ul><p>for each part:</p><ul><li>index.bin:</li><li>metadata.json:</li><li>metaindex.bin:</li><li>timestamps.bin:</li><li>values.bin:</li></ul><p>snapshot:</p><h3 id=write-flow>Write Flow<a href=#write-flow class=hanchor arialabel=Anchor>#</a></h3><p>Ingested Data -> create reverted index(two type of index) -> Buffer -> In-memory Parts -> Disk (flush into disk periodically) -> Merge in the background -> Disk</p><p>When index created?</p><p>VM vs Prometheus (Disk)
TBD</p><h3 id=read-flow>Read Flow<a href=#read-flow class=hanchor arialabel=Anchor>#</a></h3><h2 id=referrence>Referrence<a href=#referrence class=hanchor arialabel=Anchor>#</a></h2><ul><li><a href=https://docs.victoriametrics.com/single-server-victoriametrics/>https://docs.victoriametrics.com/single-server-victoriametrics/</a></li><li><a href=https://github.com/VictoriaMetrics/VictoriaMetrics/issues/3268>https://github.com/VictoriaMetrics/VictoriaMetrics/issues/3268</a></li></ul></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><a href=https://chejinying.com/tech/posts/go/gorm/gorm/ class="button inline prev">&lt; [<span class=button__text>GORM</span>]
</a>::
<a href=https://chejinying.com/tech/posts/prometheus/ class="button inline next">[<span class=button__text>Prometheus Overview</span>] ></a></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=https://chejinying.com/tech/bundle.min.js></script></div></body></html>