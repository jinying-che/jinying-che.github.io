<!doctype html><html lang=en><head><title>Victorial Metrics :: </title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Victorial Metrics"><meta name=keywords content="computer,ai,network"><meta name=robots content="noodp"><link rel=canonical href=https://jinying-che.github.io/posts/victorial_metrics/><link rel=stylesheet href=https://jinying-che.github.io/styles.css><link rel="shortcut icon" href=https://jinying-che.github.io/img/theme-colors/green.png><link rel=apple-touch-icon href=https://jinying-che.github.io/img/theme-colors/green.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Victorial Metrics"><meta property="og:description" content="Victorial Metrics"><meta property="og:url" content="https://jinying-che.github.io/posts/victorial_metrics/"><meta property="og:site_name" content><meta property="og:image" content="https://jinying-che.github.io/img/favicon/green.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2024-02-13 07:37:29 +0800 +0800"></head><body class=green><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>jinying-che:~#</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/posts>Home</a></li><li><a href=/tags>Tags</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/posts>Home</a></li><li><a href=/tags>Tags</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://jinying-che.github.io/posts/victorial_metrics/>Victorial Metrics</a></h1><div class=post-meta><time class=post-date>2024-02-13 ::</time></div><span class=post-tags>#<a href=https://jinying-che.github.io/tags/monitor/>monitor</a>&nbsp;
#<a href=https://jinying-che.github.io/tags/victoria-metrics/>Victoria Metrics</a>&nbsp;</span><div class=post-content><div><h2 id=quick-start>Quick Start<a href=#quick-start class=hanchor arialabel=Anchor>&#8983;</a></h2><p><strong>Victoria Metrics</strong></p><ul><li>An easy way to run VictoriaMetrics locally is to build from the <a href=https://docs.victoriametrics.com/single-server-victoriametrics/#how-to-build-from-sources>source code</a> as there&rsquo;re lots of vm binaries like vmselect, vmstorage, vminsert, etc. to download, and all of them are maintained in the same <a href=https://github.com/VictoriaMetrics/VictoriaMetrics>repository</a>, and <code>Makefile</code> is quite straightforward.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone git@github.com:VictoriaMetrics/VictoriaMetrics.git
</span></span><span style=display:flex><span>make victoria-metrics
</span></span><span style=display:flex><span>mv /bin/victoria-metrics /usr/bin
</span></span></code></pre></div><ul><li>Run VictoriaMetrics With Systemd</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>Unit<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Description<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Victoria Metrics Single&#34;</span>
</span></span><span style=display:flex><span>Documentation<span style=color:#f92672>=</span>https://https://docs.victoriametrics.com/
</span></span><span style=display:flex><span>After<span style=color:#f92672>=</span>network.target
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Service<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Type<span style=color:#f92672>=</span>simple
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ExecStart<span style=color:#f92672>=</span>/usr/bin/victoria-metrics-prod <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        -storageDataPath<span style=color:#f92672>=</span>/data/vm <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        -httpListenAddr<span style=color:#f92672>=</span>:8428 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        -promscrape.config<span style=color:#f92672>=</span>/etc/prometheus/scrape.yml
</span></span><span style=display:flex><span>ExecStop<span style=color:#f92672>=</span>/bin/kill -s SIGTERM $MAINPID
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Restart<span style=color:#f92672>=</span>on-failure
</span></span><span style=display:flex><span>SuccessExitStatus<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>LimitNOFILE<span style=color:#f92672>=</span><span style=color:#ae81ff>65536</span>
</span></span><span style=display:flex><span>StandardOutput<span style=color:#f92672>=</span>/var/log/vm/out.log
</span></span><span style=display:flex><span>StandardError<span style=color:#f92672>=</span>/var/log/vm/err.log
</span></span><span style=display:flex><span>SyslogIdentifier<span style=color:#f92672>=</span>prometheus
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Install<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>WantedBy<span style=color:#f92672>=</span>multi-user.target
</span></span></code></pre></div><h2 id=storage>Storage<a href=#storage class=hanchor arialabel=Anchor>&#8983;</a></h2><h3 id=on-disk-layout>On Disk Layout<a href=#on-disk-layout class=hanchor arialabel=Anchor>&#8983;</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>./data
</span></span><span style=display:flex><span>├── big
</span></span><span style=display:flex><span>│   ├── 2024_01
</span></span><span style=display:flex><span>│   │   ├── 17A6101707C91B08
</span></span><span style=display:flex><span>│   │   │   ├── index.bin
</span></span><span style=display:flex><span>│   │   │   ├── metadata.json
</span></span><span style=display:flex><span>│   │   │   ├── metaindex.bin
</span></span><span style=display:flex><span>│   │   │   ├── timestamps.bin
</span></span><span style=display:flex><span>│   │   │   └── values.bin
</span></span><span style=display:flex><span>│   ├── 2024_02
</span></span><span style=display:flex><span>│   ├── ...
</span></span><span style=display:flex><span>│   └── snapshots
</span></span><span style=display:flex><span>│       ├── 20240109092239-179E85E399D5EFDA
</span></span><span style=display:flex><span>│       │   ├── 2023_12
</span></span><span style=display:flex><span>│       │   └── 2024_01
</span></span><span style=display:flex><span>│       └── 20240111104529-179E85E399D5EFDB
</span></span><span style=display:flex><span>│           ├── 2023_12
</span></span><span style=display:flex><span>│           └── 2024_01
</span></span><span style=display:flex><span>├── flock.lock
</span></span><span style=display:flex><span>└── small
</span></span><span style=display:flex><span>    ├── 2024_01
</span></span><span style=display:flex><span>    │   ├── 17A6101707CC58EF
</span></span><span style=display:flex><span>    │   │   ├── index.bin
</span></span><span style=display:flex><span>    │   │   ├── metadata.json
</span></span><span style=display:flex><span>    │   │   ├── metaindex.bin
</span></span><span style=display:flex><span>    │   │   ├── timestamps.bin
</span></span><span style=display:flex><span>    │   │   └── values.bin
</span></span><span style=display:flex><span>    └── snapshots
</span></span><span style=display:flex><span>        ├── 20240109092239-179E85E399D5EFDA
</span></span><span style=display:flex><span>        │   ├── 2023_12
</span></span><span style=display:flex><span>        │   └── 2024_01
</span></span><span style=display:flex><span>        └── 20240111104529-179E85E399D5EFDB
</span></span><span style=display:flex><span>            ├── 2023_12
</span></span><span style=display:flex><span>            └── 2024_01
</span></span></code></pre></div><p>For details, see <a href=https://docs.victoriametrics.com/single-server-victoriametrics/#storage>doc</a></p><h3 id=writing-data-flow>Writing Data Flow<a href=#writing-data-flow class=hanchor arialabel=Anchor>&#8983;</a></h3><p>VM vs Prometheus (Disk)
TBD</p><h2 id=referrence>Referrence<a href=#referrence class=hanchor arialabel=Anchor>&#8983;</a></h2><ul><li><a href=https://docs.victoriametrics.com/single-server-victoriametrics/>https://docs.victoriametrics.com/single-server-victoriametrics/</a></li><li><a href=https://github.com/VictoriaMetrics/VictoriaMetrics/issues/3268>https://github.com/VictoriaMetrics/VictoriaMetrics/issues/3268</a></li></ul></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://jinying-che.github.io/posts/go/gorm/gorm/><span class=button__icon>←</span>
<span class=button__text>GORM</span>
</a></span><span class="button next"><a href=https://jinying-che.github.io/posts/prometheus/><span class=button__text>Prometheus Overview</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>