<!doctype html><html lang=en><head><title>DNS :: Terminal</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="DNS Overview"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://jinying-che.github.io/posts/network/dns/><link rel=stylesheet href=https://jinying-che.github.io/styles.css><link rel="shortcut icon" href=https://jinying-che.github.io/img/theme-colors/green.png><link rel=apple-touch-icon href=https://jinying-che.github.io/img/theme-colors/green.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="DNS"><meta property="og:description" content="DNS Overview"><meta property="og:url" content="https://jinying-che.github.io/posts/network/dns/"><meta property="og:site_name" content="Terminal"><meta property="og:image" content="https://jinying-che.github.io/img/favicon/green.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2023-09-20 11:47:31 +0800 +0800"></head><body class=green><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>jinying-che:~#</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/posts>Home</a></li><li><a href=/tags>Tags</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/posts>Home</a></li><li><a href=/tags>Tags</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://jinying-che.github.io/posts/network/dns/>DNS</a></h1><div class=post-meta><time class=post-date>2023-09-20 ::</time></div><span class=post-tags>#<a href=https://jinying-che.github.io/tags/network/>network</a>&nbsp;
#<a href=https://jinying-che.github.io/tags/dns/>dns</a>&nbsp;</span><div class=post-content><div><p><a href=https://en.wikipedia.org/wiki/Domain_Name_System>Domain Name System (DNS)</a> is the phonebook of the Internet. It translates human-readable domain names (google.com) to machine-readable IP addresses (142.251.46.238).</p><p>DNS is not very complex but super useful.</p><h2 id=how-does-dns-work>How does DNS work?<a href=#how-does-dns-work class=hanchor arialabel=Anchor>&#8983;</a></h2><p><img src=/images/dns_architecture.svg alt="dns architecutre"></p><p><img src=/images/dns_flow.png alt="dns flow"></p><p>The basic flow to query dns level by level as follows, the previous server stores the next server address, e.g. Root Nameserver stores TLD Nameserver addresss.</p><ol><li><strong>Brower cache and OS cache</strong></li><li><strong>DNS Resolver</strong>: is responsible for initiating and sequencing the queries that ultimately lead to a full resolution (translation) of the resource sought. DNS resolvers are classified by a variety of query methods, such as <strong>recursive</strong>, <strong>non-recursive</strong>, and <strong>iterative</strong>. A resolution process may use a combination of these methods.</li><li><strong>Root Nameserver</strong>: the first step in translating (resolving) human readable host names into IP addresses. It stores the IP addresses of TLD, There are <strong>13</strong> logical Root Nameserver globally, e.g.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>- l.root-servers.net.
</span></span><span style=display:flex><span>- m.root-servers.net.
</span></span><span style=display:flex><span>- a.root-servers.net.
</span></span><span style=display:flex><span>- b.root-servers.net.
</span></span><span style=display:flex><span>- c.root-servers.net.
</span></span><span style=display:flex><span>- d.root-servers.net.
</span></span><span style=display:flex><span>- e.root-servers.net.
</span></span><span style=display:flex><span>- f.root-servers.net.
</span></span><span style=display:flex><span>- g.root-servers.net.
</span></span><span style=display:flex><span>- h.root-servers.net.
</span></span><span style=display:flex><span>- i.root-servers.net.
</span></span><span style=display:flex><span>- j.root-servers.net.
</span></span><span style=display:flex><span>- k.root-servers.net.
</span></span></code></pre></div></li><li><strong>TLD Nameserver</strong> (Top Level Domain Server): It stores the IP addresses of authoritative name servers, e.g.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>- .com
</span></span><span style=display:flex><span>- .org
</span></span><span style=display:flex><span>- .edu
</span></span><span style=display:flex><span>- .net
</span></span><span style=display:flex><span>- .us
</span></span><span style=display:flex><span>- .cn
</span></span><span style=display:flex><span>- ...
</span></span></code></pre></div></li><li><strong>Authoritative Nameserver</strong>: it provides the actual anwser for the dns request.</li></ol><h3 id=example>Example<a href=#example class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Let&rsquo;s try to trace the dns request for <code>jinying-che.github.io</code> from my local laptop:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>➜  ~ dig +trace jinying-che.github.io
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; +trace jinying-che.github.io
</span></span><span style=display:flex><span>;; global options: +cmd
</span></span><span style=display:flex><span>.                       <span style=color:#ae81ff>467805</span>  IN      NS      l.root-servers.net.
</span></span><span style=display:flex><span>.                       <span style=color:#ae81ff>467805</span>  IN      NS      m.root-servers.net.
</span></span><span style=display:flex><span>.                       <span style=color:#ae81ff>467805</span>  IN      NS      a.root-servers.net.
</span></span><span style=display:flex><span>.                       <span style=color:#ae81ff>467805</span>  IN      NS      b.root-servers.net.
</span></span><span style=display:flex><span>.                       <span style=color:#ae81ff>467805</span>  IN      NS      c.root-servers.net.
</span></span><span style=display:flex><span>.                       <span style=color:#ae81ff>467805</span>  IN      NS      d.root-servers.net.
</span></span><span style=display:flex><span>.                       <span style=color:#ae81ff>467805</span>  IN      NS      e.root-servers.net.
</span></span><span style=display:flex><span>.                       <span style=color:#ae81ff>467805</span>  IN      NS      f.root-servers.net.
</span></span><span style=display:flex><span>.                       <span style=color:#ae81ff>467805</span>  IN      NS      g.root-servers.net.
</span></span><span style=display:flex><span>.                       <span style=color:#ae81ff>467805</span>  IN      NS      h.root-servers.net.
</span></span><span style=display:flex><span>.                       <span style=color:#ae81ff>467805</span>  IN      NS      i.root-servers.net.
</span></span><span style=display:flex><span>.                       <span style=color:#ae81ff>467805</span>  IN      NS      j.root-servers.net.
</span></span><span style=display:flex><span>.                       <span style=color:#ae81ff>467805</span>  IN      NS      k.root-servers.net.
</span></span><span style=display:flex><span>.                       <span style=color:#ae81ff>467805</span>  IN      RRSIG   NS <span style=color:#ae81ff>8</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>518400</span> <span style=color:#ae81ff>20231002140000</span> <span style=color:#ae81ff>20230919130000</span> <span style=color:#ae81ff>11019</span> . hSoNzesJLtJnf9gXYqG4SMrn8R78uNEqUgc1xcFKglavg16gnPrvQnuP sLb74PkmHE+uqQ1ZPs31X6XrA8E/yhlF8r4kPQAaEiMhkLXsZ1QPLgfj wHFWsFcVmWZTKJIQO/6H7P6ht0jhX0pLVRVRTZtIPH0uYqz6w9Z8vWuw Haaqm+48d5+cuyn2iNNqxO8omlQLALwaALu6/7hZPQfgkH6+XBPvSagj 6FOV+zun2hwKNCwrJ7elYQCfL7xi0UbjAOt+OOJYJfF9vfJq9qYnt8/O IBrfdRHtsryH/Fmk/wUPhgNEMYLwgz4n1z+a25A7q5ofocId5lsDYAUJ YxLSNA<span style=color:#f92672>==</span>
</span></span><span style=display:flex><span>;; Received <span style=color:#ae81ff>1097</span> bytes from 192.168.0.1#53<span style=color:#f92672>(</span>192.168.0.1<span style=color:#f92672>)</span> in <span style=color:#ae81ff>11</span> ms
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>io.                     <span style=color:#ae81ff>172800</span>  IN      NS      a2.nic.io.
</span></span><span style=display:flex><span>io.                     <span style=color:#ae81ff>172800</span>  IN      NS      c0.nic.io.
</span></span><span style=display:flex><span>io.                     <span style=color:#ae81ff>172800</span>  IN      NS      a0.nic.io.
</span></span><span style=display:flex><span>io.                     <span style=color:#ae81ff>172800</span>  IN      NS      b0.nic.io.
</span></span><span style=display:flex><span>io.                     <span style=color:#ae81ff>86400</span>   IN      DS      <span style=color:#ae81ff>57355</span> <span style=color:#ae81ff>8</span> <span style=color:#ae81ff>2</span> 95A57C3BAB7849DBCDDF7C72ADA71A88146B141110318CA5BE672057 E865C3E2
</span></span><span style=display:flex><span>io.                     <span style=color:#ae81ff>86400</span>   IN      RRSIG   DS <span style=color:#ae81ff>8</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>86400</span> <span style=color:#ae81ff>20231003050000</span> <span style=color:#ae81ff>20230920040000</span> <span style=color:#ae81ff>11019</span> . TnYR1fL2pnUlBTTsJleHjjmxjLs96HwMJOtcHvTzwK31ZBoT+sp76dHq bsQfFgX7FqyTjIzF+z/W7dK1wKnO1ONvhbeWCTZO8SAIMaJU4ZyPAAMo D+xM7YpRHrAYES2wi+cX20kDDKUXauhxiesHqywSMdNK6XugyLluSaz1 J5c2Y0S2r7pZwEPV5v6w9TjzNQOfcfu0NLQx1i7JAbuLExGc7/7pjqxY XB2LH9FtyzgfAkm0ovTu5BRzbUxO/lSURlGIPsI05aFVz6HEhnl04Ujb dmir+S3ffOahHgxjD2al8yIx/FS67ZCi+va2pA6lHdHsktrNnTn2tGZt aUJrzg<span style=color:#f92672>==</span>
</span></span><span style=display:flex><span>;; Received <span style=color:#ae81ff>637</span> bytes from 192.112.36.4#53<span style=color:#f92672>(</span>g.root-servers.net<span style=color:#f92672>)</span> in <span style=color:#ae81ff>85</span> ms
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>github.io.              <span style=color:#ae81ff>3600</span>    IN      NS      dns2.p05.nsone.net.
</span></span><span style=display:flex><span>github.io.              <span style=color:#ae81ff>3600</span>    IN      NS      ns-1622.awsdns-10.co.uk.
</span></span><span style=display:flex><span>github.io.              <span style=color:#ae81ff>3600</span>    IN      NS      dns3.p05.nsone.net.
</span></span><span style=display:flex><span>github.io.              <span style=color:#ae81ff>3600</span>    IN      NS      dns1.p05.nsone.net.
</span></span><span style=display:flex><span>github.io.              <span style=color:#ae81ff>3600</span>    IN      NS      ns-692.awsdns-22.net.
</span></span><span style=display:flex><span>0d790076pp5pfktg2hrthj5bj6ckckcb.io. <span style=color:#ae81ff>3600</span> IN NSEC3 <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>10</span> 332539EE7F95C32A 0D7N522D3BFMA1LA01BUIOBUK6MROGMU  NS SOA RRSIG DNSKEY NSEC3PARAM
</span></span><span style=display:flex><span>0d790076pp5pfktg2hrthj5bj6ckckcb.io. <span style=color:#ae81ff>3600</span> IN RRSIG NSEC3 <span style=color:#ae81ff>8</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3600</span> <span style=color:#ae81ff>20231011082044</span> <span style=color:#ae81ff>20230920072044</span> <span style=color:#ae81ff>32553</span> io. hg8Fr2R0FnIfikGso1mx3B66B9QtVVcMoOL108Ahw5D7TUTo/AL+vpP9 AFEa5GMnkenQqbWsp5/xgEuhJxeMbbzF88roBy6hnSoLq21qysLpIQuC Q+TprenA+f7dKiza7RLTTPnv6qN1b50Z/VSsowMK6Fw353h2WLOUAg0G 2I4<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>0jehpe7obc68rhh4ntet0u9o44qmosmo.io. <span style=color:#ae81ff>3600</span> IN NSEC3 <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>10</span> 332539EE7F95C32A 0JES1F5OD9SG1E4CCRGBS865PMBUV4PC  NS DS RRSIG
</span></span><span style=display:flex><span>0jehpe7obc68rhh4ntet0u9o44qmosmo.io. <span style=color:#ae81ff>3600</span> IN RRSIG NSEC3 <span style=color:#ae81ff>8</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3600</span> <span style=color:#ae81ff>20231008005435</span> <span style=color:#ae81ff>20230916235435</span> <span style=color:#ae81ff>32553</span> io. b6iUJ3A5Govhm/HVZIU7ygw7l8tHsUnDFCZaR50HDmYtbmi/g83PASgw 4IgNm42FI2u8oX3HZ2ce8gBK48ts/1bbSCxthUqO2KrSlou+Okh7z+J1 TAeRsC8FkkA/RHu+ymFM1g0BB2cv23Rnftwtl9jsD4JoDKSzhVcKiOx9 WIA<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>;; Received <span style=color:#ae81ff>687</span> bytes from 65.22.160.17#53<span style=color:#f92672>(</span>a0.nic.io<span style=color:#f92672>)</span> in <span style=color:#ae81ff>7</span> ms
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>jinying-che.github.io.  <span style=color:#ae81ff>3600</span>    IN      A       185.199.108.153
</span></span><span style=display:flex><span>jinying-che.github.io.  <span style=color:#ae81ff>3600</span>    IN      A       185.199.109.153
</span></span><span style=display:flex><span>jinying-che.github.io.  <span style=color:#ae81ff>3600</span>    IN      A       185.199.110.153
</span></span><span style=display:flex><span>jinying-che.github.io.  <span style=color:#ae81ff>3600</span>    IN      A       185.199.111.153
</span></span><span style=display:flex><span>;; Received <span style=color:#ae81ff>114</span> bytes from 198.51.44.5#53<span style=color:#f92672>(</span>dns1.p05.nsone.net<span style=color:#f92672>)</span> in <span style=color:#ae81ff>168</span> ms
</span></span></code></pre></div><ol><li>Get NS Record: 13 Root Nameservers from <code>192.168.0.1</code>(DNS Resolver) which is configured by <code>/etc/resolv.conf</code></li><li>Get NS Record: TLD (Top Level Domain) from one of Root Nameserve <code>g.root-servers.net</code></li><li>Get NS Record: Authoritative Nameserver from one of TLD <code>a0.nic.io</code></li><li>Get A Record: Actual ip address from one of Authoritative Nameserver <code>dns1.p05.nsone.net</code></li></ol><h2 id=dns-record>DNS Record<a href=#dns-record class=hanchor arialabel=Anchor>&#8983;</a></h2><p>There&rsquo;re a lot of <a href=https://en.wikipedia.org/wiki/List_of_DNS_record_types>DNS Record types</a>, the follows are the common record from the client perspective:</p><table><thead><tr><th>Record</th><th>Function</th></tr></thead><tbody><tr><td>A</td><td>Address record: Returns a 32-bit IPv4 address</td></tr><tr><td>AAAA</td><td>IPv6 address record: Returns a 128-bit IPv6 address</td></tr><tr><td>NS</td><td>Name server record: Delegates a DNS zone to use the given authoritative name servers</td></tr><tr><td>CNAME</td><td>Canonical name record: Alias of one name to another: the DNS lookup will continue by retrying the lookup with the new name</td></tr></tbody></table><h2 id=configuration>Configuration<a href=#configuration class=hanchor arialabel=Anchor>&#8983;</a></h2><p>There&rsquo;re two way to query the ip address by domain, typically whenever a system needs to resolve a name, it first checks the <code>/etc/hosts</code> file. If no entry matched, it sends a query to the configured DNS server (by <code>/etc/resolv.conf</code>).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># /etc/resolv.conf defines the namesever address</span>
</span></span><span style=display:flex><span>$ cat /etc/resolv.conf
</span></span><span style=display:flex><span>nameserver 114.114.114.114
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># /etc/hosts defines the domain and ip address pair directly</span>
</span></span><span style=display:flex><span>$ cat /etc/hosts
</span></span><span style=display:flex><span>127.0.0.1 localhost      
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># The order in which (/etc/hosts and /etc/resolv.conf) file is checked </span>
</span></span><span style=display:flex><span><span style=color:#75715e># is defined in the /etc/nsswitch.conf file</span>
</span></span><span style=display:flex><span>cat /etc/nsswitch.conf | grep host 
</span></span><span style=display:flex><span>hosts:          files dns
</span></span></code></pre></div><h2 id=protocol>Protocol<a href=#protocol class=hanchor arialabel=Anchor>&#8983;</a></h2><p>DNS originally used the <code>UDP</code> as transport over IP. Reliability, security, and privacy concerns spawned the use of the <code>TCP</code> as well as numerous other protocol developments.</p><h2 id=referrence>Referrence<a href=#referrence class=hanchor arialabel=Anchor>&#8983;</a></h2><ul><li><a href=https://www.cloudflare.com/learning/dns/what-is-dns/>https://www.cloudflare.com/learning/dns/what-is-dns/</a></li><li><a href=https://en.wikipedia.org/wiki/Domain_Name_System>https://en.wikipedia.org/wiki/Domain_Name_System</a></li><li><a href=https://blog.bytebytego.com/p/how-does-the-domain-name-system-dns>https://blog.bytebytego.com/p/how-does-the-domain-name-system-dns</a></li><li><a href=https://draveness.me/dns-coredns/>https://draveness.me/dns-coredns/</a></li><li><a href=https://draveness.me/whys-the-design-dns-udp-tcp/>https://draveness.me/whys-the-design-dns-udp-tcp/</a></li><li><a href=https://time.geekbang.org/column/article/81850>https://time.geekbang.org/column/article/81850</a></li><li><a href=https://datatracker.ietf.org/doc/html/rfc1035>RFC 1035</a></li><li><a href=https://en.wikipedia.org/wiki/List_of_DNS_record_types>DNS Record Names</a></li><li><a href=https://www.computernetworkingnotes.com/linux-tutorials/the-etc-hosts-etc-resolv-conf-and-etc-nsswitch-conf-files.html>/etc/hosts vs /etc/resolv.conf vs etc/nsswitch.conf</a></li></ul></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button next"><a href=https://jinying-che.github.io/posts/sla_vs_slo_vs_sli/><span class=button__text>SLA vs SLO vs SLI</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2023 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>