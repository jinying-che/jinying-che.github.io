<!doctype html><html lang=en><head><title>TCP ::</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="TCP overview"><meta name=keywords content="computer,ai,network"><meta name=robots content="noodp"><link rel=canonical href=https://chejinying.com/tech/posts/network/tcp/><link rel=stylesheet href=https://chejinying.com/tech/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://chejinying.com/tech/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://chejinying.com/tech/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://chejinying.com/tech/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://chejinying.com/tech/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://chejinying.com/tech/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://chejinying.com/tech/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css><link rel=stylesheet href=https://chejinying.com/tech/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css><link rel=stylesheet href=https://chejinying.com/tech/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://chejinying.com/tech/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css><link rel=stylesheet href=https://chejinying.com/tech/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css><link rel=stylesheet href=https://chejinying.com/tech/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link rel=stylesheet href=https://chejinying.com/tech/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel=stylesheet href=https://chejinying.com/tech/terminal.css><link rel="shortcut icon" href=https://chejinying.com/tech/favicon.png><link rel=apple-touch-icon href=https://chejinying.com/tech/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="TCP"><meta property="og:description" content="TCP overview"><meta property="og:url" content="https://chejinying.com/tech/posts/network/tcp/"><meta property="og:site_name" content><meta property="og:image" content="https://chejinying.com/tech/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2021-02-01 23:25:26 +0800 +0800"></head><body><div class="container center"><header class=header><div class=header__inner><div class=header__logo><a href=https://chejinying.com/tech/><div class=logo>jinying-che:~#</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=https://chejinying.com/tech/posts>Home</a></li><li><a href=https://chejinying.com/tech/tags>Tags</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=https://chejinying.com/tech/posts>Home</a></li><li><a href=https://chejinying.com/tech/tags>Tags</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://chejinying.com/tech/posts/network/tcp/>TCP</a></h1><div class=post-meta><time class=post-date>2021-02-01</time></div><span class=post-tags>#<a href=https://chejinying.com/tech/tags/network/>network</a>&nbsp;</span><div class=post-content><div><p>TCP is really complex protocol and there&rsquo;s a lot of tutorials online to learn TCP, however as time being, it&rsquo;s probably being outdated, same as my post. Hence I would recommend the official <a href=https://datatracker.ietf.org/doc/html/rfc793#autoid-16>RFC 793</a> as the only true source. Here&rsquo;s a summary of <a href=https://datatracker.ietf.org/doc/html/rfc793#autoid-16>RFC 793</a>.</p><h3 id=tcp-header>TCP Header<a href=#tcp-header class=hanchor arialabel=Anchor>#</a></h3><p><a href=https://datatracker.ietf.org/doc/html/rfc793#autoid-16>TCP Header Format</a></p><pre tabindex=0><code>    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          Source Port          |       Destination Port        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Sequence Number                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Acknowledgment Number                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Data |           |U|A|P|R|S|F|                               |
   | Offset| Reserved  |R|C|S|S|Y|I|            Window             |
   |       |           |G|K|H|T|N|N|                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Checksum            |         Urgent Pointer        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Options                    |    Padding    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                             data                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</code></pre><h3 id=tcp-state-machine>TCP State Machine<a href=#tcp-state-machine class=hanchor arialabel=Anchor>#</a></h3><p>Be noted that 11 <a href=https://datatracker.ietf.org/doc/html/rfc793#autoid-17>TCP Connection States Diagram</a> indicating state to state transformation not cliet to server communication.</p><pre tabindex=0><code>


                              +---------+ ---------\      active OPEN
                              |  CLOSED |            \    -----------
                              +---------+&lt;---------\   \   create TCB
                                |     ^              \   \  snd SYN
                   passive OPEN |     |   CLOSE        \   \
                   ------------ |     | ----------       \   \
                    create TCB  |     | delete TCB         \   \
                                V     |                      \   \
                              +---------+            CLOSE    |    \
                              |  LISTEN |          ---------- |     |
                              +---------+          delete TCB |     |
                   rcv SYN      |     |     SEND              |     |
                  -----------   |     |    -------            |     V
 +---------+      snd SYN,ACK  /       \   snd SYN          +---------+
 |         |&lt;-----------------           ------------------&gt;|         |
 |   SYN   |                    rcv SYN                     |   SYN   |
 |   RCVD  |&lt;-----------------------------------------------|   SENT  |
 |         |                    snd ACK                     |         |
 |         |------------------           -------------------|         |
 +---------+   rcv ACK of SYN  \       /  rcv SYN,ACK       +---------+
   |           --------------   |     |   -----------
   |                  x         |     |     snd ACK
   |                            V     V
   |  CLOSE                   +---------+
   | -------                  |  ESTAB  |
   | snd FIN                  +---------+
   |                   CLOSE    |     |    rcv FIN
   V                  -------   |     |    -------
 +---------+          snd FIN  /       \   snd ACK          +---------+
 |  FIN    |&lt;-----------------           ------------------&gt;|  CLOSE  |
 | WAIT-1  |------------------                              |   WAIT  |
 +---------+          rcv FIN  \                            +---------+
   | rcv ACK of FIN   -------   |                            CLOSE  |
   | --------------   snd ACK   |                           ------- |
   V        x                   V                           snd FIN V
 +---------+                  +---------+                   +---------+
 |FINWAIT-2|                  | CLOSING |                   | LAST-ACK|
 +---------+                  +---------+                   +---------+
   |                rcv ACK of FIN |                 rcv ACK of FIN |
   |  rcv FIN       -------------- |    Timeout=2MSL -------------- |
   |  -------              x       V    ------------        x       V
    \ snd ACK                 +---------+delete TCB         +---------+
     ------------------------&gt;|TIME WAIT|------------------&gt;| CLOSED  |
                              +---------+                   +---------+
</code></pre><table><thead><tr><th>Head</th><th>Meaning</th></tr></thead><tbody><tr><td>LISTEN</td><td>represents waiting for a connection request from any remote TCP and port</td></tr><tr><td>SYN-SENT</td><td>represents waiting for a matching connection request after having sent a connection request</td></tr><tr><td>SYN-RECEIVED</td><td>represents waiting for a confirming connection request acknowledgment after having both received and sent a connection request</td></tr><tr><td>ESTABLISHED</td><td>represents an open connection, data received can be delivered to the user. The normal state for the data transfer phase of the connection</td></tr><tr><td>FIN-WAIT-1</td><td>represents waiting for a connection termination request from the remote TCP, or an acknowledgment of the connection termination request previously sent</td></tr><tr><td>FIN-WAIT-2</td><td>represents waiting for a connection termination request from the <em>remote</em> TCP</td></tr><tr><td>CLOSE-WAIT</td><td>represents waiting for a connection termination request from the <em>local</em> user</td></tr><tr><td>CLOSING</td><td>represents waiting for a connection termination request acknowledgment from the remote TCP</td></tr><tr><td>LAST-ACK</td><td>represents waiting for an acknowledgment of the connection termination request previously sent to the remote TCP (which includes an acknowledgment of its connection termination request)</td></tr><tr><td>TIME-WAIT</td><td>represents waiting for enough time to pass to be sure the remote TCP received the acknowledgment of its connection termination request</td></tr><tr><td>CLOSED</td><td>represents no connection state at all</td></tr></tbody></table><p>Here may be a more readable diagram.
<img src=https://chejinying.com/tech/images/tcpfsm.png alt="tcp state Machine"></p><h4 id=tcp-open-three-way-handshake>TCP Open: Three-Way Handshake<a href=#tcp-open-three-way-handshake class=hanchor arialabel=Anchor>#</a></h4><p><img src=https://chejinying.com/tech/images/tcp_open.svg alt="tcp open"></p><p><img src=https://chejinying.com/tech/images/tcp_open_bytebytego.png alt="tcp open"></p><h4 id=tcp-close-four-way-handshake>TCP Close: Four-Way Handshake<a href=#tcp-close-four-way-handshake class=hanchor arialabel=Anchor>#</a></h4><p><img src=https://chejinying.com/tech/images/tcp_close_bytebytego.png alt="tcp close"></p><h3 id=reference>Reference<a href=#reference class=hanchor arialabel=Anchor>#</a></h3><ul><li><a href=http://www.tcpipguide.com/free/t_TCPConnectionEstablishmentProcessTheThreeWayHandsh-3.htm>http://www.tcpipguide.com/free/t_TCPConnectionEstablishmentProcessTheThreeWayHandsh-3.htm</a></li><li><a href=http://www.tcpipguide.com/free/t_TCPConnectionTermination-2.htm>http://www.tcpipguide.com/free/t_TCPConnectionTermination-2.htm</a></li><li><a href=https://datatracker.ietf.org/doc/html/rfc793#autoid-16>RFC 793</a></li><li><a href=https://draveness.me/whys-the-design-tcp-three-way-handshake/>https://draveness.me/whys-the-design-tcp-three-way-handshake/</a></li><li><a href=https://blog.bytebytego.com/p/everything-you-always-wanted-to-know>https://blog.bytebytego.com/p/everything-you-always-wanted-to-know</a></li><li><a href=https://www.alibabacloud.com/blog/tcp-syn-queue-and-accept-queue-overflow-explained_599203>Alibaba: TCP SYN Queue and Accept Queue Overflow Explained</a></li></ul></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><a href=https://chejinying.com/tech/posts/algorithm/leetcode/ class="button inline prev">&lt; [<span class=button__text>Algorithm: How I leetcode</span>]
</a>::
<a href=https://chejinying.com/tech/posts/c/ctags/ class="button inline next">[<span class=button__text>Setup Universal Ctags for Mac</span>] ></a></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=https://chejinying.com/tech/bundle.min.js></script></div></body></html>