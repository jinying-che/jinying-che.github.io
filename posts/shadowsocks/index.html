<!doctype html><html lang=en><head><title>Setup Shadowsocks Server And Client ::</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="In this article, we will setup the Shadowsock Server and Client from scratch and solve the issue during and after the setup.
"><meta name=keywords content="computer,ai,network"><meta name=robots content="noodp"><link rel=canonical href=https://chejinying.com/tech/posts/shadowsocks/><link rel=stylesheet href=https://chejinying.com/tech/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://chejinying.com/tech/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://chejinying.com/tech/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://chejinying.com/tech/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://chejinying.com/tech/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://chejinying.com/tech/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://chejinying.com/tech/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css><link rel=stylesheet href=https://chejinying.com/tech/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css><link rel=stylesheet href=https://chejinying.com/tech/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://chejinying.com/tech/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css><link rel=stylesheet href=https://chejinying.com/tech/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css><link rel=stylesheet href=https://chejinying.com/tech/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link rel=stylesheet href=https://chejinying.com/tech/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel=stylesheet href=https://chejinying.com/tech/terminal.css><link rel="shortcut icon" href=https://chejinying.com/tech/favicon.png><link rel=apple-touch-icon href=https://chejinying.com/tech/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Setup Shadowsocks Server And Client"><meta property="og:description" content="In this article, we will setup the Shadowsock Server and Client from scratch and solve the issue during and after the setup.
"><meta property="og:url" content="https://chejinying.com/tech/posts/shadowsocks/"><meta property="og:site_name" content><meta property="og:image" content="https://chejinying.com/tech/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2021-04-23 09:22:08 +0800 +0800"></head><body><div class="container center"><header class=header><div class=header__inner><div class=header__logo><a href=https://chejinying.com/tech/><div class=logo>jinying-che:~#</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=https://chejinying.com/tech/posts>Home</a></li><li><a href=https://chejinying.com/tech/tags>Tags</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=https://chejinying.com/tech/posts>Home</a></li><li><a href=https://chejinying.com/tech/tags>Tags</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://chejinying.com/tech/posts/shadowsocks/>Setup Shadowsocks Server And Client</a></h1><div class=post-meta><time class=post-date>2021-04-23</time></div><div class=post-content><div><p>In this article, we will setup the Shadowsock Server and Client from scratch and solve the issue during and after the setup.</p><h2 id=shadowsocks-server>Shadowsocks Server<a href=#shadowsocks-server class=hanchor arialabel=Anchor>#</a></h2><hr><p>Install the latest <code>Ubuntu</code> in vps, my vps provier is <a href=https://bandwagonhost.com/index.php>https://bandwagonhost.com/index.php</a>, the route is: <em>My Service > KiwiVM Control Panel > Install new OS</em></p><h3 id=1-installing-shadowsocks-libev>1. Installing Shadowsocks-libev<a href=#1-installing-shadowsocks-libev class=hanchor arialabel=Anchor>#</a></h3><h4 id=install-snap>Install <a href=https://snapcraft.io/about>Snap</a><a href=#install-snap class=hanchor arialabel=Anchor>#</a></h4><pre tabindex=0><code>$ sudo apt update
$ sudo apt install snapd
$ sudo reboot
</code></pre><h4 id=install-shadowsocks-libev>Install <a href=https://github.com/shadowsocks/shadowsocks-libev>Shadowsocks-libev</a><a href=#install-shadowsocks-libev class=hanchor arialabel=Anchor>#</a></h4><pre tabindex=0><code>$ sudo snap install shadowsocks-libev
</code></pre><h3 id=2-configuring-proxy-server>2. Configuring proxy server<a href=#2-configuring-proxy-server class=hanchor arialabel=Anchor>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># first time to use snap, this path should be the config convention of Snap apps </span>
</span></span><span class=line><span class=cl>sudo mkdir -p /var/snap/shadowsocks-libev/common/etc/shadowsocks-libev
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo vim /var/snap/shadowsocks-libev/common/etc/shadowsocks-libev/config.json
</span></span></code></pre></div><h4 id=configjson>config.json<a href=#configjson class=hanchor arialabel=Anchor>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;server&#34;</span><span class=p>:[</span><span class=s2>&#34;::0&#34;</span><span class=p>,</span> <span class=s2>&#34;0.0.0.0&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;server_port&#34;</span><span class=p>:</span><span class=mi>4443</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;password&#34;</span><span class=p>:</span><span class=s2>&#34;your password&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;timeout&#34;</span><span class=p>:</span><span class=mi>300</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;method&#34;</span><span class=p>:</span><span class=s2>&#34;aes-256-gcm&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;nameserver&#34;</span><span class=p>:</span><span class=s2>&#34;1.1.1.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;mode&#34;</span><span class=p>:</span><span class=s2>&#34;tcp_and_udp&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Note</strong>: &ldquo;server&rdquo;:["::0", &ldquo;0.0.0.0&rdquo;] &ndash;> support IPv4 and IPv6</p><h3 id=3-creating-systemd-service-unit-config>3. Creating systemd service unit config<a href=#3-creating-systemd-service-unit-config class=hanchor arialabel=Anchor>#</a></h3><h4 id=shadowsocks-libev-serverservice>shadowsocks-libev-server@.service<a href=#shadowsocks-libev-serverservice class=hanchor arialabel=Anchor>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ sudo vim /etc/systemd/system/shadowsocks-libev-server@.service
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>Unit<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>Description</span><span class=o>=</span>Shadowsocks-Libev Custom Server Service <span class=k>for</span> %I
</span></span><span class=line><span class=cl><span class=nv>Documentation</span><span class=o>=</span>man:ss-server<span class=o>(</span>1<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nv>After</span><span class=o>=</span>network-online.target
</span></span><span class=line><span class=cl><span class=nv>StartLimitIntervalSec</span><span class=o>=</span><span class=m>500</span>
</span></span><span class=line><span class=cl><span class=nv>StartLimitBurst</span><span class=o>=</span><span class=m>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>Service<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>Type</span><span class=o>=</span>simple
</span></span><span class=line><span class=cl><span class=nv>Restart</span><span class=o>=</span>always
</span></span><span class=line><span class=cl><span class=nv>RestartSec</span><span class=o>=</span>5s
</span></span><span class=line><span class=cl><span class=nv>ExecStart</span><span class=o>=</span>/usr/bin/snap run shadowsocks-libev.ss-server -c /var/snap/shadowsocks-libev/common/etc/shadowsocks-libev/%i.json
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>Install<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>WantedBy</span><span class=o>=</span>multi-user.target
</span></span></code></pre></div><p>Two things to take note:</p><ul><li><code>shadowsocks-libev-server@.service</code> is a filename (<em>systemd style</em>)</li><li><code>man systemd.service</code> to understand the details, btw it&rsquo;s better to set <code>Restart=always</code> if you prefer the log-term running</li></ul><p>Start the service and make it managed by systemd</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># Note that the @config is used to select the configuration file</span>
</span></span><span class=line><span class=cl>$ sudo systemctl <span class=nb>enable</span> --now shadowsocks-libev-server@config
</span></span></code></pre></div><h3 id=4-troubleshooting>4. Troubleshooting<a href=#4-troubleshooting class=hanchor arialabel=Anchor>#</a></h3><h4 id=command>Command<a href=#command class=hanchor arialabel=Anchor>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># Status</span>
</span></span><span class=line><span class=cl>$ sudo systemctl status shadowsocks-libev-server@config
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Log</span>
</span></span><span class=line><span class=cl><span class=c1># Check the certain process that managed by systemd</span>
</span></span><span class=line><span class=cl><span class=c1># journalctl is a command for viewing logs collected by systemd</span>
</span></span><span class=line><span class=cl>$ journalctl -u shadowsocks-libev-server@config
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Check all the processes log</span>
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> /var/log/
</span></span><span class=line><span class=cl>$ less syslog  <span class=c1># can check any related log, TBD</span>
</span></span></code></pre></div><h4 id=cases>Cases<a href=#cases class=hanchor arialabel=Anchor>#</a></h4><h5 id=process-stopped-unexpectedly>Process stopped unexpectedly<a href=#process-stopped-unexpectedly class=hanchor arialabel=Anchor>#</a></h5><ul><li>Root Cause: process that managed by systemd will stop when user exit the session</li></ul><blockquote><p><a href=https://github.com/systemd/systemd/issues/8486>https://github.com/systemd/systemd/issues/8486</a></p></blockquote><ul><li>Fix: <code>loginctl enable-linger</code></li></ul><h2 id=shadowsocks-client>Shadowsocks Client<a href=#shadowsocks-client class=hanchor arialabel=Anchor>#</a></h2><hr><h3 id=chrome>Chrome<a href=#chrome class=hanchor arialabel=Anchor>#</a></h3><p>Enable the socks5 proxy for Chrome in macOS</p><ol><li><code>brew install shadowsocks-libev</code></li><li>run <code>ss-local -h</code> to understand how to setup shadowsocks client locally, for example:<ul><li><code>ss-local -s server_ip -p port -k password -m aes-256-cfb -l 1081 -v</code></li></ul></li><li>install and setup SwitchyOmeg for Chrome:</li><li>import <a href=https://shadowsockshelp.github.io/Shadowsocks/Chrome.html>GFW List</a> and enable the auto-switch</li></ol><h3 id=global-terminal>Global (Terminal)<a href=#global-terminal class=hanchor arialabel=Anchor>#</a></h3><p>Some request from termial or other Apps are supposed to go through the socks5 tunnel as well, the following steps will forward the traffic to the local port that listened by the shadowsocks client:</p><ol><li>setup helper function in bash or zsh profile, so that it&rsquo;s able to control the proxy manually in the current terminal session via <code>proxy-on</code> or <code>proxy-off</code>:<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=k>function</span> proxy-off<span class=o>(){</span>
</span></span><span class=line><span class=cl>    <span class=nb>unset</span> http_proxy
</span></span><span class=line><span class=cl>    <span class=nb>unset</span> https_proxy
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;proxy off&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> proxy-on<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>export</span> <span class=nv>no_proxy</span><span class=o>=</span><span class=s2>&#34;localhost,127.0.0.1,localaddress,.localdomain.com&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>export</span> <span class=nv>http_proxy</span><span class=o>=</span><span class=s2>&#34;socks5://127.0.0.1:1081&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>export</span> <span class=nv>https_proxy</span><span class=o>=</span><span class=nv>$http_proxy</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;proxy on: </span><span class=nv>$http_proxy</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></li><li>run <code>ss-local ... -v</code></li><li>test via <code>curl cip.cc</code> or <code>curl ifconfig.me</code>, by right the ip that running shadowsocks server should be printed</li></ol><h2 id=reference>Reference<a href=#reference class=hanchor arialabel=Anchor>#</a></h2><ul><li><a href=https://www.freedesktop.org/software/systemd/man/systemd.service.html>systemd config</a> or check by <code>man systemd.service</code></li><li><a href=https://www.linuxbabe.com/ubuntu/shadowsocks-libev-proxy-server-ubuntu>https://www.linuxbabe.com/ubuntu/shadowsocks-libev-proxy-server-ubuntu</a></li><li><a href=https://upcloud.com/community/tutorials/install-shadowsocks-libev-socks5-proxy/>https://upcloud.com/community/tutorials/install-shadowsocks-libev-socks5-proxy/</a></li><li><a href=https://unix.stackexchange.com/questions/225401/how-to-see-full-log-from-systemctl-status-service>https://unix.stackexchange.com/questions/225401/how-to-see-full-log-from-systemctl-status-service</a></li><li><a href=https://shadowsockshelp.github.io/Shadowsocks/Chrome.html>https://shadowsockshelp.github.io/Shadowsocks/Chrome.html</a></li></ul></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><a href=https://chejinying.com/tech/posts/hhkb/ class="button inline prev">&lt; [<span class=button__text>HHKB</span>]
</a>::
<a href=https://chejinying.com/tech/posts/network/hardware/ class="button inline next">[<span class=button__text>Brief Introduction of Network Hardware</span>] ></a></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=https://chejinying.com/tech/bundle.min.js></script></div></body></html>