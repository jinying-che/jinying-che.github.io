<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Victoria Metrics on</title><link>https://jinying-che.github.io/tags/victoria-metrics/</link><description>Recent content in Victoria Metrics on</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Tue, 13 Feb 2024 07:37:29 +0800</lastBuildDate><atom:link href="https://jinying-che.github.io/tags/victoria-metrics/index.xml" rel="self" type="application/rss+xml"/><item><title>Victorial Metrics</title><link>https://jinying-che.github.io/posts/victorial_metrics/</link><pubDate>Tue, 13 Feb 2024 07:37:29 +0800</pubDate><guid>https://jinying-che.github.io/posts/victorial_metrics/</guid><description>&lt;h2 id="quick-start">Quick Start&lt;/h2>
&lt;p>&lt;strong>Victoria Metrics&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>An easy way to run VictoriaMetrics locally is to build from the &lt;a href="https://docs.victoriametrics.com/single-server-victoriametrics/#how-to-build-from-sources">source code&lt;/a> as there&amp;rsquo;re lots of vm binaries like vmselect, vmstorage, vminsert, etc. to download, and all of them are maintained in the same &lt;a href="https://github.com/VictoriaMetrics/VictoriaMetrics">repository&lt;/a>, and &lt;code>Makefile&lt;/code> is quite straightforward.&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>git clone git@github.com:VictoriaMetrics/VictoriaMetrics.git
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>make victoria-metrics
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mv /bin/victoria-metrics /usr/bin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>Run VictoriaMetrics With Systemd&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>Unit&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Description&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;Victoria Metrics Single&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Documentation&lt;span style="color:#f92672">=&lt;/span>https://https://docs.victoriametrics.com/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>After&lt;span style="color:#f92672">=&lt;/span>network.target
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>Service&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Type&lt;span style="color:#f92672">=&lt;/span>simple
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ExecStart&lt;span style="color:#f92672">=&lt;/span>/usr/bin/victoria-metrics-prod &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -storageDataPath&lt;span style="color:#f92672">=&lt;/span>/data/vm &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -httpListenAddr&lt;span style="color:#f92672">=&lt;/span>:8428 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -promscrape.config&lt;span style="color:#f92672">=&lt;/span>/etc/prometheus/scrape.yml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ExecStop&lt;span style="color:#f92672">=&lt;/span>/bin/kill -s SIGTERM $MAINPID
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Restart&lt;span style="color:#f92672">=&lt;/span>on-failure
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>SuccessExitStatus&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>LimitNOFILE&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">65536&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>StandardOutput&lt;span style="color:#f92672">=&lt;/span>/var/log/vm/out.log
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>StandardError&lt;span style="color:#f92672">=&lt;/span>/var/log/vm/err.log
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>SyslogIdentifier&lt;span style="color:#f92672">=&lt;/span>prometheus
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>Install&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>WantedBy&lt;span style="color:#f92672">=&lt;/span>multi-user.target
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="storage">Storage&lt;/h2>
&lt;h3 id="on-disk-layout">On Disk Layout&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-txt" data-lang="txt">&lt;span style="display:flex;">&lt;span>./data
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>├── big
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   ├── 2024_01
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   │   ├── 17A6101707C91B08
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   │   │   ├── index.bin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   │   │   ├── metadata.json
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   │   │   ├── metaindex.bin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   │   │   ├── timestamps.bin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   │   │   └── values.bin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   ├── 2024_02
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   ├── ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   └── snapshots
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   ├── 20240109092239-179E85E399D5EFDA
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   │   ├── 2023_12
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   │   └── 2024_01
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   └── 20240111104529-179E85E399D5EFDB
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   ├── 2023_12
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   └── 2024_01
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>├── flock.lock
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>└── small
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ├── 2024_01
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> │   ├── 17A6101707CC58EF
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> │   │   ├── index.bin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> │   │   ├── metadata.json
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> │   │   ├── metaindex.bin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> │   │   ├── timestamps.bin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> │   │   └── values.bin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>    └── snapshots
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>    ├── 20240109092239-179E85E399D5EFDA
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>    │   ├── 2023_12
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>    │   └── 2024_01
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>    └── 20240111104529-179E85E399D5EFDB
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>    ├── 2023_12
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>    └── 2024_01
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>For details, see &lt;a href="https://docs.victoriametrics.com/single-server-victoriametrics/#storage">doc&lt;/a>&lt;/p></description><content>&lt;h2 id="quick-start">Quick Start&lt;/h2>
&lt;p>&lt;strong>Victoria Metrics&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>An easy way to run VictoriaMetrics locally is to build from the &lt;a href="https://docs.victoriametrics.com/single-server-victoriametrics/#how-to-build-from-sources">source code&lt;/a> as there&amp;rsquo;re lots of vm binaries like vmselect, vmstorage, vminsert, etc. to download, and all of them are maintained in the same &lt;a href="https://github.com/VictoriaMetrics/VictoriaMetrics">repository&lt;/a>, and &lt;code>Makefile&lt;/code> is quite straightforward.&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>git clone git@github.com:VictoriaMetrics/VictoriaMetrics.git
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>make victoria-metrics
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mv /bin/victoria-metrics /usr/bin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>Run VictoriaMetrics With Systemd&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>Unit&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Description&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;Victoria Metrics Single&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Documentation&lt;span style="color:#f92672">=&lt;/span>https://https://docs.victoriametrics.com/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>After&lt;span style="color:#f92672">=&lt;/span>network.target
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>Service&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Type&lt;span style="color:#f92672">=&lt;/span>simple
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ExecStart&lt;span style="color:#f92672">=&lt;/span>/usr/bin/victoria-metrics-prod &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -storageDataPath&lt;span style="color:#f92672">=&lt;/span>/data/vm &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -httpListenAddr&lt;span style="color:#f92672">=&lt;/span>:8428 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -promscrape.config&lt;span style="color:#f92672">=&lt;/span>/etc/prometheus/scrape.yml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ExecStop&lt;span style="color:#f92672">=&lt;/span>/bin/kill -s SIGTERM $MAINPID
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Restart&lt;span style="color:#f92672">=&lt;/span>on-failure
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>SuccessExitStatus&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>LimitNOFILE&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">65536&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>StandardOutput&lt;span style="color:#f92672">=&lt;/span>/var/log/vm/out.log
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>StandardError&lt;span style="color:#f92672">=&lt;/span>/var/log/vm/err.log
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>SyslogIdentifier&lt;span style="color:#f92672">=&lt;/span>prometheus
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>Install&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>WantedBy&lt;span style="color:#f92672">=&lt;/span>multi-user.target
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="storage">Storage&lt;/h2>
&lt;h3 id="on-disk-layout">On Disk Layout&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-txt" data-lang="txt">&lt;span style="display:flex;">&lt;span>./data
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>├── big
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   ├── 2024_01
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   │   ├── 17A6101707C91B08
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   │   │   ├── index.bin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   │   │   ├── metadata.json
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   │   │   ├── metaindex.bin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   │   │   ├── timestamps.bin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   │   │   └── values.bin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   ├── 2024_02
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   ├── ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   └── snapshots
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   ├── 20240109092239-179E85E399D5EFDA
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   │   ├── 2023_12
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   │   └── 2024_01
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   └── 20240111104529-179E85E399D5EFDB
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   ├── 2023_12
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>│   └── 2024_01
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>├── flock.lock
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>└── small
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ├── 2024_01
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> │   ├── 17A6101707CC58EF
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> │   │   ├── index.bin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> │   │   ├── metadata.json
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> │   │   ├── metaindex.bin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> │   │   ├── timestamps.bin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> │   │   └── values.bin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>    └── snapshots
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>    ├── 20240109092239-179E85E399D5EFDA
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>    │   ├── 2023_12
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>    │   └── 2024_01
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>    └── 20240111104529-179E85E399D5EFDB
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>    ├── 2023_12
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>    └── 2024_01
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>For details, see &lt;a href="https://docs.victoriametrics.com/single-server-victoriametrics/#storage">doc&lt;/a>&lt;/p>
&lt;h3 id="writing-data-flow">Writing Data Flow&lt;/h3>
&lt;p>VM vs Prometheus (Disk)
TBD&lt;/p>
&lt;h2 id="referrence">Referrence&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://docs.victoriametrics.com/single-server-victoriametrics/">https://docs.victoriametrics.com/single-server-victoriametrics/&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/VictoriaMetrics/VictoriaMetrics/issues/3268">https://github.com/VictoriaMetrics/VictoriaMetrics/issues/3268&lt;/a>&lt;/li>
&lt;/ul></content></item></channel></rss>